// ==UserScript==
// @name [VOT] - Voice Over Translation
// @name:de [VOT] - Voice-Over-Video-Übersetzung
// @name:es [VOT] - Traducción de vídeo en off
// @name:fr [VOT] - Traduction vidéo voix-off
// @name:it [VOT] - Traduzione Video fuori campo
// @name:ru [VOT] - Закадровый перевод видео
// @name:zh [VOT] - 画外音视频翻译
// @description A small extension that adds a Yandex Browser video translation to other browsers
// @description:de Eine kleine Erweiterung, die eine Voice-over-Übersetzung von Videos aus dem Yandex-Browser zu anderen Browsern hinzufügt
// @description:es Una pequeña extensión que agrega una traducción de voz en off de un video de Yandex Browser a otros navegadores
// @description:fr Une petite extension qui ajoute la traduction vocale de la vidéo du Navigateur Yandex à d'autres navigateurs
// @description:it Una piccola estensione che aggiunge la traduzione vocale del video dal browser Yandex ad altri browser
// @description:ru Небольшое расширение, которое добавляет закадровый перевод видео из Яндекс Браузера в другие браузеры
// @description:zh 一个小扩展，它增加了视频从Yandex浏览器到其他浏览器的画外音翻译
<<<<<<< HEAD
// @version 1.4.1-beta7
=======
// @version 1.4.1-beta5
>>>>>>> 1ceeecb9facfffb7f90db73da1fb1b4f1b4e6ac9
// @author sodapng, mynovelhost, Toil, SashaXser, MrSoczekXD
// @supportURL https://github.com/ilyhalight/voice-over-translation/issues
// @match *://*.youtube.com/*
// @match *://*.youtube-nocookie.com/*
// @match *://*.twitch.tv/*
// @match *://*.xvideos.com/*
// @match *://*.pornhub.com/*
// @match *://*.vk.com/*
// @match *://*.vk.ru/*
// @match *://invidious.snopyta.org/*
// @match *://invidious.kavin.rocks/*
// @match *://vid.puffyan.us/*
// @match *://invidious.namazso.eu/*
// @match *://inv.riverside.rocks/*
// @match *://yt.artemislena.eu/*
// @match *://invidious.flokinet.to/*
// @match *://invidious.esmailelbob.xyz/*
// @match *://invidious.nerdvpn.de/*
// @match *://invidious.slipfox.xyz/*
// @match *://invidio.xamh.de/*
// @match *://invidious.dhusch.de/*
// @match *://*.piped.video/*
// @match *://piped.tokhmi.xyz/*
// @match *://piped.moomoo.me/*
// @match *://piped.syncpundit.io/*
// @match *://piped.mha.fi/*
// @match *://watch.whatever.social/*
// @match *://piped.garudalinux.org/*
// @match *://efy.piped.pages.dev/*
// @match *://watch.leptons.xyz/*
// @match *://piped.lunar.icu/*
// @match *://yt.dc09.ru/*
// @match *://piped.mint.lgbt/*
// @match *://*.il.ax/*
// @match *://piped.privacy.com.de/*
// @match *://piped.esmailelbob.xyz/*
// @match *://piped.projectsegfau.lt/*
// @match *://piped.in.projectsegfau.lt/*
// @match *://piped.us.projectsegfau.lt/*
// @match *://piped.privacydev.net/*
// @match *://piped.palveluntarjoaja.eu/*
// @match *://piped.smnz.de/*
// @match *://piped.adminforge.de/*
// @match *://piped.qdi.fi/*
// @match *://piped.hostux.net/*
// @match *://piped.chauvet.pro/*
// @match *://piped.jotoma.de/*
// @match *://piped.pfcd.me/*
// @match *://piped.frontendfriendly.xyz/*
// @match *://*.yewtu.be/*
// @match *://inv.vern.cc/*
// @match *://*.vimeo.com/*
// @match *://*.9gag.com/*
// @match *://*.twitter.com/*
// @match *://*.facebook.com/*
// @match *://*.rutube.ru/*
// @match *://*.bilibili.com/*
// @match *://my.mail.ru/*
// @match *://*.bitchute.com/*
// @match *://*.coursera.org/learn/*
// @match *://*.udemy.com/course/*
<<<<<<< HEAD
// @match *://*.tiktok.com/*
// @match *://proxitok.pabloferreiro.es/*
// @match *://proxitok.pussthecat.org/*
// @match *://tok.habedieeh.re/*
// @match *://proxitok.esmailelbob.xyz/*
// @match *://proxitok.privacydev.net/*
// @match *://tok.artemislena.eu/*
// @match *://tok.adminforge.de/*
// @match *://tik.hostux.net/*
// @match *://tt.vern.cc/*
// @match *://cringe.whatever.social/*
// @match *://proxitok.lunar.icu/*
// @match *://proxitok.privacy.com.de/*
=======
>>>>>>> 1ceeecb9facfffb7f90db73da1fb1b4f1b4e6ac9
// @connect api.browser.yandex.ru
// @downloadURL https://raw.githubusercontent.com/ilyhalight/voice-over-translation/master/dist/vot.user.js
// @grant GM_xmlhttpRequest
// @grant GM_info
// @homepageURL https://github.com/ilyhalight/voice-over-translation/issues
// @icon https://translate.yandex.ru/icons/favicon.ico
// @namespace vot
// @require https://cdnjs.cloudflare.com/ajax/libs/protobufjs/7.2.3/light/protobuf.min.js
// @updateURL https://raw.githubusercontent.com/ilyhalight/voice-over-translation/master/dist/vot.user.js
// ==/UserScript==

<<<<<<< HEAD
(()=>{"use strict";var e={"./node_modules/css-loader/dist/cjs.js!./src/styles/main.css":(e,t,n)=>{n.d(t,{Z:()=>s});var o=n("./node_modules/css-loader/dist/runtime/noSourceMaps.js"),a=n.n(o),r=n("./node_modules/css-loader/dist/runtime/api.js"),i=n.n(r)()(a());i.push([e.id,'.translationBlock {\n  padding: 0.45rem !important;\n  width: max-content;\n  position: absolute;\n  background: #2e2f34;\n  border-radius: 0.5rem !important;\n  left: 50%;\n  top: 5rem;\n  transform: translate(-50%);\n  text-align: center;\n  opacity: 0;\n  transition: opacity 1s;\n  -webkit-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n  z-index: 100;\n}\n\n.translationBtn {\n  position: relative;\n  display: inline-block;\n  vertical-align: middle;\n  color: #fff;\n  padding-right: 0.25rem !important;\n  cursor: pointer;\n  font: 600 12px / 14px "Segoe UI", BlinkMacSystemFont, Arial, sans-serif;\n}\n\n.translationBlock:hover {\n  opacity: 1;\n}\n\n.translationMenu {\n  display: inline-block;\n  vertical-align: middle;\n  border-left: 1px solid #424348;\n  max-height: 16px;\n  max-width: 24px;\n  cursor: pointer;\n}\n\n.translationMenuIcon {\n  padding: 0 10px !important;\n  width: 24px;\n}\n\n.translationIAlice {\n  display: inline-block;\n  vertical-align: middle;\n  max-height: 26px;\n  max-width: 50px;\n}\n\n.translationIconAlice {\n  height: 24px !important;\n  width: 24px !important;\n}\n\n.translationITranslate {\n  display: inline-block;\n  vertical-align: middle;\n  max-height: 20px;\n  max-width: 20px;\n}\n\n.translationMenuContent {\n  position: absolute;\n  background: #2e2f34;\n  color: #fff;\n  display: none;\n  border-radius: 1rem !important;\n  left: 50%;\n  top: 10rem;\n  transform: translate(-50%);\n  text-align: left;\n  font: 600 14px / 16px "Segoe UI", BlinkMacSystemFont, Arial, sans-serif !important;\n\n  width: 300px;\n  /* height: 375px; */\n  opacity: 0;\n  z-index: 100;\n  transition: opacity 0.5s ease;\n}\n\n.VOTMenuSlider {\n  -webkit-appearance: none !important;\n  appearance: none !important;\n  width: 268px !important;\n  height: 8px !important;\n  outline: none !important;\n  margin-top: 0.5rem;\n  opacity: 0.7;\n  /* background: #3C3F4D !important; */\n  background: rgb(253, 222, 85, 0.6) !important;\n  border: none !important;\n  border-radius: 2rem !important;\n  -webkit-transition: 0.2s !important;\n  transition: opacity 0.2s ease !important;\n}\n\n.VOTMenuSlider:hover {\n  opacity: 1;\n}\n\n.VOTMenuSlider::-webkit-slider-thumb {\n  -webkit-appearance: none !important;\n  appearance: none !important;\n  width: 10px !important;\n  height: 10px !important;\n  border-radius: 50% !important;\n  border: none !important;\n  background: #fff !important;\n  cursor: pointer !important;\n}\n\n.VOTMenuSlider::-moz-range-thumb {\n  width: 10px !important;\n  height: 10px !important;\n  border-radius: 50% !important;\n  border: none !important;\n  background: #fff !important;\n  cursor: pointer !important;\n}\n\n.VOTMenuSlider::-ms-thumb {\n  width: 10px !important;\n  height: 10px !important;\n  border-radius: 50% !important;\n  border: none !important;\n  background: #fff !important;\n  cursor: pointer !important;\n}\n\n.VOTMenuSlider::-ms-fill-lower {\n  height: 8px !important;\n  border-radius: 2rem !important;\n  background: linear-gradient(\n    90.1deg,\n    rgba(186, 153, 244, 0.85) -5.78%,\n    rgba(236, 138, 202, 0.7) 56.46%,\n    rgba(239, 168, 117, 0.6) 108.93%\n  ) !important;\n}\n\n.VOTMenuSlider::-moz-range-progress {\n  height: 8px !important;\n  border-radius: 2rem !important;\n  background: linear-gradient(\n    90.1deg,\n    rgba(186, 153, 244, 0.85) -5.78%,\n    rgba(236, 138, 202, 0.7) 56.46%,\n    rgba(239, 168, 117, 0.6) 108.93%\n  ) !important;\n}\n\n.translationHeader {\n  padding-bottom: 0.5rem !important;\n}\n\n.translationMainHeader {\n  margin: 16px !important;\n  color: #fff;\n  font: 900 14px / 16px "Segoe UI", BlinkMacSystemFont, Arial, sans-serif !important;\n}\n\n.translationMenuOptions {\n  display: flex;\n  flex-flow: column wrap;\n}\n\n.translationMenuContainer {\n  /* width: 100%; */\n  padding-left: 16px !important;\n  padding-top: 5px !important;\n  display: inline-block !important;\n}\n\n.translationMenuContainer > input {\n  appearance: auto !important;\n  vertical-align: text-bottom;\n}\n\n.translationMenuText {\n  color: #fff;\n  display: inline-flex;\n  width: 80%;\n}\n\n.translationVolumeBox,\n.translationVideoVolumeBox {\n  padding-top: 0.5rem !important;\n}\n\n.translationDropDB,\n.translationUdemyData {\n  border: none !important;\n  border-radius: 4px !important;\n  background: #5426ff !important;\n  color: #fff !important;\n  padding: 6px 16px !important;\n  margin-left: auto !important;\n  cursor: pointer !important;\n}\n\n.translationUdemyData {\n  margin: 16px !important;\n}\n\n.translationDownload {\n  background: #5426ff !important;\n  color: #fff !important;\n  padding: 2px 10px !important;\n  border-radius: 4px !important;\n  cursor: pointer;\n  display: none;\n}\n\n.translationMenuFunctional {\n  display: flex;\n  margin: 16px !important;\n}\n\n.VOTMenuSelect {\n  width: 110px;\n  border-radius: 5px !important;\n  border: 1px solid #dadce0 !important;\n  box-shadow: 0 1px 3px -2px #9098a9;\n  box-sizing: border-box !important;\n  color: #2e2f34 !important;\n  background: #fff !important;\n  padding: 5px !important;\n}\n\n.VOTMenuSelect:focus {\n  outline: none;\n}\n\n.VOTMenuSelect:focus {\n  outline: none;\n  border-color: #0077ff;\n  box-shadow: 0 0 0 2px rgba(#0077ff, 0.2);\n}\n\n#VOTSelectLanguages {\n  display: flex !important;\n  margin-left: 5px;\n}\n\n#VOTSelectLanguages svg {\n  margin: 0 5px;\n}\n\n#VOTSubtitlesLangContainer {\n  display: flex !important;\n  justify-content: space-between;\n  align-items: center;\n  margin-left: 5px;\n}\n\n#VOTSubtitlesLang {\n  margin-right: 25px;\n}\n\n.VOTSubtitlesWidget {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  position: absolute;\n  width: 50%;\n  max-height: 100%;\n  min-height: 20%;\n  z-index: 100;\n  left: 25%;\n  top: 75%;\n  pointer-events: none;\n}\n\n.VOTSubtitlesWidget > div {\n  position: relative;\n  max-width: 100%;\n  max-height: 100%;\n  width: max-content;\n  background: #2e2f34cc;\n  border-radius: 1rem;\n  pointer-events: all;\n  padding: 1rem;\n  font-size: 2rem;\n  box-sizing: border-box;\n  -webkit-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n}\n\n.VOTSubtitlesWidget .passed {\n  color: #9e84ff;\n}\n',""]);const s=i},"./node_modules/css-loader/dist/runtime/api.js":e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",o=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),o&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),o&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,o,a,r){"string"==typeof e&&(e=[[null,e,void 0]]);var i={};if(o)for(var s=0;s<this.length;s++){var l=this[s][0];null!=l&&(i[l]=!0)}for(var u=0;u<e.length;u++){var d=[].concat(e[u]);o&&i[d[0]]||(void 0!==r&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=r),n&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=n):d[2]=n),a&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=a):d[4]="".concat(a)),t.push(d))}},t}},"./node_modules/css-loader/dist/runtime/noSourceMaps.js":e=>{e.exports=function(e){return e[1]}},"./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js":e=>{var t=[];function n(e){for(var n=-1,o=0;o<t.length;o++)if(t[o].identifier===e){n=o;break}return n}function o(e,o){for(var r={},i=[],s=0;s<e.length;s++){var l=e[s],u=o.base?l[0]+o.base:l[0],d=r[u]||0,c="".concat(u," ").concat(d);r[u]=d+1;var p=n(c),m={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==p)t[p].references++,t[p].updater(m);else{var g=a(m,o);o.byIndex=s,t.splice(s,0,{identifier:c,updater:g,references:1})}i.push(c)}return i}function a(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,a){var r=o(e=e||[],a=a||{});return function(e){e=e||[];for(var i=0;i<r.length;i++){var s=n(r[i]);t[s].references--}for(var l=o(e,a),u=0;u<r.length;u++){var d=n(r[u]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}r=l}}},"./node_modules/style-loader/dist/runtime/insertBySelector.js":e=>{var t={};e.exports=function(e,n){var o=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(n)}},"./node_modules/style-loader/dist/runtime/insertStyleElement.js":e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},"./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js":(e,t,n)=>{e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},"./node_modules/style-loader/dist/runtime/styleDomAPI.js":e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var o="";n.supports&&(o+="@supports (".concat(n.supports,") {")),n.media&&(o+="@media ".concat(n.media," {"));var a=void 0!==n.layer;a&&(o+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),o+=n.css,a&&(o+="}"),n.media&&(o+="}"),n.supports&&(o+="}");var r=n.sourceMap;r&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),t.styleTagTransform(o,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},"./node_modules/style-loader/dist/runtime/styleTagTransform.js":e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},"./src/config/config.js":(e,t,n)=>{n.d(t,{I1:()=>a,IM:()=>i,Rr:()=>r,iF:()=>o});const o="api.browser.yandex.ru",a="xtGCyGdTY2Jy6OMEKdTuXev3Twhkamgm",r="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 YaBrowser/23.7.1.1140 Yowser/2.5 Safari/537.36",i=.15},"./src/utils/debug.js":(e,t,n)=>{n.d(t,{Z:()=>o});const o={log:(...e)=>{}}},"./src/yandexRequest.js":(e,t,n)=>{n.r(t),n.d(t,{default:()=>r});var o=n("./src/config/config.js"),a=n("./src/utils/debug.js");const r=async function(e,t,n,r){try{a.Z.log("yandexRequest:",e);const i={url:`https://${o.iF}${e}`,method:"POST",headers:{Accept:"application/x-protobuf","Accept-Language":"en","Content-Type":"application/x-protobuf","User-Agent":o.Rr,Pragma:"no-cache","Cache-Control":"no-cache","Sec-Fetch-Mode":"no-cors","sec-ch-ua":null,"sec-ch-ua-mobile":null,"sec-ch-ua-platform":null,...n},binary:!0,data:new Blob([t]),responseType:"arraybuffer"};GM_xmlhttpRequest({...i,onload:e=>{a.Z.log("yandexRequest:",e.status,e),r(200===e.status,e.response)},onerror:e=>{console.error("[VOT]",e),r(!1)}})}catch(e){console.error("[VOT]",e),r(!1)}}}},t={};function n(o){var a=t[o];if(void 0!==a)return a.exports;var r=t[o]={id:o,exports:{}};return e[o](r,r.exports,n),r.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nc=void 0,(()=>{var e=n("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),t=n.n(e),o=n("./node_modules/style-loader/dist/runtime/styleDomAPI.js"),a=n.n(o),r=n("./node_modules/style-loader/dist/runtime/insertBySelector.js"),i=n.n(r),s=n("./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js"),l=n.n(s),u=n("./node_modules/style-loader/dist/runtime/insertStyleElement.js"),d=n.n(u),c=n("./node_modules/style-loader/dist/runtime/styleTagTransform.js"),p=n.n(c),m=n("./node_modules/css-loader/dist/cjs.js!./src/styles/main.css"),g={};g.styleTagTransform=p(),g.setAttributes=l(),g.insert=i().bind(null,"head"),g.domAPI=a(),g.insertStyleElement=d(),t()(m.Z,g),m.Z&&m.Z.locals&&m.Z.locals;const h=JSON.parse('{"recommended":"recommended","translateVideo":"Translate video","disableTranslate":"Turn off","translationSettings":"Translation settings","resetSettings":"Reset settings","videoBeingTranslated":"The video is being translated","videoLanguage":"Video language","translationLanguage":"Translation language","translationTake":"The translation will take","translationTakeMoreThanHour":"The translation will take more than an hour","translationTakeAboutMinute":"The translation will take about a minute","translationTakeFewMinutes":"The translation will take a few minutes","translationTakeApproximatelyMinutes":"The translation will take approximately {0} minutes","translationTakeApproximatelyMinute":"The translation will take approximately {0} minutes","unSupportedExtensionError":"Error! {0} is not supported by this version of the extension!\\n\\nPlease use the cloudflare version of the VOT extension.","requestTranslationFailed":"Failed to request video translation","audioNotReceived":"Audio link not received","grantPermissionToAutoPlay":"Grant permission to autoplay","neededAdditionalExtension":"An additional extension is needed to support this site","audioFormatNotSupported":"The audio format is not supported","VOTAutoTranslate":"Translate on open","VOTDontTranslateYourLang":"Do not translate from my language","VOTVolume":"Video volume","VOTVolumeTranslation":"Translation Volume","VOTAutoSetVolume":"Reduce video volume to ","VOTShowVideoSlider":"Video volume slider","VOTSyncVolume":"Link translation and video volume","VOTAudioProxy":"Proxy received audio","VOTDisableFromYourLang":"You have disabled the translation of the video in your language","VOTLiveNotSupported":"Translation of live streams is not supported","VOTPremiere":"Wait for the premiere to end before translating","VOTVideoIsTooLong":"Video is too long","VOTNoVideoIDFound":"No video ID found","VOTFailedInitDB":"Failed to initialize database","VOTDBNeedUpdate":"The database needs an update, please reload the page","VOTDisabledForDBUpdating":"VOT is disabled due to an error when updating the Database. Close all open tabs with {0} and try again","VOTFailedWriteToDB":"Data could not be written to the database","VOTFailedReadFromDB":"Data could not be retrieved from the database","VOTSubtitles":"Subtitles","VOTSubtitlesDisabled":"Disabled","VOTSubtitlesMaxLength":"Subtitles max length","VOTHighlightWords":"Highlight words","VOTTranslatedFrom":"translated from","VOTAutogenerated":"autogenerated","langs":{"af":"Afrikaans","ak":"Akan","sq":"Albanian","am":"Amharic","ar":"Arabic","hy":"Armenian","as":"Assamese","ay":"Aymara","az":"Azerbaijani","bn":"Bangla","eu":"Basque","be":"Belarusian","bho":"Bhojpuri","bs":"Bosnian","bg":"Bulgarian","my":"Burmese","ca":"Catalan","ceb":"Cebuano","zh":"Chinese","zh-Hans":"Chinese (Simplified)","zh-Hant":"Chinese (Traditional)","co":"Corsican","hr":"Croatian","cs":"Czech","da":"Danish","dv":"Divehi","nl":"Dutch","en":"English","eo":"Esperanto","et":"Estonian","ee":"Ewe","fil":"Filipino","fi":"Finnish","fr":"French","gl":"Galician","lg":"Ganda","ka":"Georgian","de":"German","el":"Greek","gn":"Guarani","gu":"Gujarati","ht":"Haitian Creole","ha":"Hausa","haw":"Hawaiian","iw":"Hebrew","hi":"Hindi","hmn":"Hmong","hu":"Hungarian","is":"Icelandic","ig":"Igbo","id":"Indonesian","ga":"Irish","it":"Italian","ja":"Japanese","jv":"Javanese","kn":"Kannada","kk":"Kazakh","km":"Khmer","rw":"Kinyarwanda","ko":"Korean","kri":"Krio","ku":"Kurdish","ky":"Kyrgyz","lo":"Lao","la":"Latin","lv":"Latvian","ln":"Lingala","lt":"Lithuanian","lb":"Luxembourgish","mk":"Macedonian","mg":"Malagasy","ms":"Malay","ml":"Malayalam","mt":"Maltese","mi":"Māori","mr":"Marathi","mn":"Mongolian","ne":"Nepali","nso":"Northern Sotho","no":"Norwegian","ny":"Nyanja","or":"Odia","om":"Oromo","ps":"Pashto","fa":"Persian","pl":"Polish","pt":"Portuguese","pa":"Punjabi","qu":"Quechua","ro":"Romanian","ru":"Russian","sm":"Samoan","sa":"Sanskrit","gd":"Scottish Gaelic","sr":"Serbian","sn":"Shona","sd":"Sindhi","si":"Sinhala","sk":"Slovak","sl":"Slovenian","so":"Somali","st":"Southern Sotho","es":"Spanish","su":"Sundanese","sw":"Swahili","sv":"Swedish","tg":"Tajik","ta":"Tamil","tt":"Tatar","te":"Telugu","th":"Thai","ti":"Tigrinya","ts":"Tsonga","tr":"Turkish","tk":"Turkmen","uk":"Ukrainian","ur":"Urdu","ug":"Uyghur","uz":"Uzbek","vi":"Vietnamese","cy":"Welsh","fy":"Western Frisian","xh":"Xhosa","yi":"Yiddish","yo":"Yoruba","zu":"Zulu"},"udemyAccessTokenExpired":"Your entered Udemy Access Token has expired","udemyModuleArgsNotFound":"Could not get udemy module data due to the fact that ModuleArgs was not found","VOTTranslationHelpNull":"Could not get the data required for the translate","enterUdemyAccessToken":"Enter Udemy Access Token","VOTUdemyData":"Udemy Data"}');var f=n("./src/utils/debug.js");const w=new class{lang=(navigator.language||navigator.userLanguage)?.substr(0,2)?.toLowerCase()??"en";locale={};constructor(){this.setLocaleFromJsonString(window.localStorage.getItem("vot-locale"))}async update(e=!1){(e||1!==Number(window.localStorage.getItem("vot-locale-version"))||window.localStorage.getItem("vot-locale-lang")!==this.lang)&&(f.Z.log("Updating locale..."),await fetch(`https://raw.githubusercontent.com/ilyhalight/voice-over-translation/master/src/localization/locales/${this.lang}.json`).then((e=>{if(200===e.status)return e.text();throw e.status})).then((e=>{window.localStorage.setItem("vot-locale",e),this.setLocaleFromJsonString(e),window.localStorage.setItem("vot-locale-version",1),window.localStorage.setItem("vot-locale-lang",this.lang)})).catch((e=>{console.error("[VOT] [localizationProvider] failed get locale, cause:",e),this.setLocaleFromJsonString(window.localStorage.getItem("vot-locale"))})))}setLocaleFromJsonString(e){try{this.locale=JSON.parse(e)??{}}catch(e){console.error("[VOT] [localizationProvider]",e),this.locale={}}}getFromLocale(e,t){const n=t.split(".").reduce(((e,t)=>{if("object"==typeof e&&e)return e[t]}),e);return void 0===n&&console.warn("[VOT] [localizationProvider] locale",e,"doesn't contain key",t),n}getDefault(e){return this.getFromLocale(h,e)??e}get(e){return this.getFromLocale(this.locale,e)??this.getFromLocale(h,e)??e}};class y extends Error{constructor(e){super(w.getDefault(e)),this.name="VOTLocalizedError",this.unlocalizedMessage=e,this.localizedMessage=w.get(e)}}const b=["ru","en","zh","ko","ar","fr","it","es","de","ja"],v=["bn","pt","cs","hi","mr","te","tr","ms","vi","ta","jv","ur","fa","gu","id","uk","kk"],T={youtube:"https://youtu.be/",twitch:"https://twitch.tv/",vimeo:"https://vimeo.com/","9gag":"https://9gag.com/gag/",vk:"https://vk.com/video?z=",xvideos:"https://www.xvideos.com/",pornhub:"https://rt.pornhub.com/view_video.php?viewkey=",udemy:"https://www.udemy.com/",twitter:"https://twitter.com/i/status/",facebook:"https://www.facebook.com/",rutube:"https://rutube.ru/video/","bilibili.com":"https://www.bilibili.com/video/","mail.ru":"https://my.mail.ru/",coub:"https://coub.com/view/",bitchute:"https://www.bitchute.com/video/",coursera:"https://www.coursera.org/",tiktok:"https://www.tiktok.com/"},V=["Violentmonkey","FireMonkey","Greasemonkey","AdGuard","OrangeMonkey"];function S(e){return new Promise((t=>{const n=document.querySelector(e);if(n)return t(n);const o=new MutationObserver((()=>{const n=document.querySelector(e);n&&(t(n),o.disconnect())}));o.observe(document.body,{childList:!0,subtree:!0,once:!0})}))}String.prototype.format||(String.prototype.format=function(){var e=arguments;return this.replace(/{(\d+)}/g,(function(t,n){return void 0!==e[n]?e[n]:t}))});const O=e=>new Promise((t=>setTimeout(t,e))),x=e=>{const t=new URL(window.location.href);switch(e){case"youtube":return t.pathname.match(/(?:watch|embed)\/([^/]+)/)?.[1]||t.searchParams.get("v");case"vk":return t.pathname.match(/^\/video-?[0-9]{8,9}_[0-9]{9}$/)?t.pathname.match(/^\/video-?[0-9]{8,9}_[0-9]{9}$/)[0].slice(1):t.searchParams.get("z")?t.searchParams.get("z").split("/")[0]:!(!t.searchParams.get("oid")||!t.searchParams.get("id"))&&`video-${Math.abs(t.searchParams.get("oid"))}_${t.searchParams.get("id")}`;case"9gag":case"gag":return t.pathname.match(/gag\/([^/]+)/)?.[1];case"twitch":if(/^m\.twitch\.tv$/.test(window.location.hostname)){const e=document.head.querySelector('link[rel="canonical"]');return e?.href.match(/videos\/([^/]+)/)?.[0]||t.pathname.slice(1)}if(/^player\.twitch\.tv$/.test(window.location.hostname))return`videos/${t.searchParams.get("video")}`;if(/^clips\.twitch\.tv$/.test(window.location.hostname)){const e=document.querySelector(".tw-link[data-test-selector='stream-info-card-component__stream-avatar-link']");return!!e&&`${e.href.replace("https://www.twitch.tv/","")}/clip/${t.searchParams.get("clip")}`}return t.pathname.match(/([^/]+)\/(?:clip)\/([^/]+)/)?t.pathname.match(/([^/]+)\/(?:clip)\/([^/]+)/)[0]:t.pathname.match(/(?:videos)\/([^/]+)/)?.[0];case"tiktok":return t.pathname.match(/([^/]+)\/video\/([^/]+)/)?.[0];case"vimeo":return t.pathname.match(/[^/]+\/[^/]+$/)?.[0]||t.pathname.match(/[^/]+$/)?.[0];case"xvideos":return t.pathname.match(/[^/]+\/[^/]+$/)?.[0];case"pornhub":return t.searchParams.get("viewkey")||t.pathname.match(/embed\/([^/]+)/)?.[1];case"twitter":return t.pathname.match(/status\/([^/]+)/)?.[1];case"udemy":return t.pathname;case"facebook":return!!t.searchParams.get("v")&&t.searchParams.get("v");case"rutube":return t.pathname.match(/(?:video|embed)\/([^/]+)/)?.[1];case"coub":return t.pathname.match(/view\/([^/]+)/)?.[1];case"bilibili.com":{const e=t.searchParams.get("bvid");if(e)return e;{let e=t.pathname.match(/video\/([^/]+)/)?.[1];return e&&t.search&&null!==t.searchParams.get("p")&&(e+=`/?p=${t.searchParams.get("p")}`),e}}case"mail.ru":if(t.pathname.startsWith("/v/")||t.pathname.startsWith("/mail/"))return t.pathname;if(t.pathname.match(/video\/embed\/([^/]+)/)){const e=document.querySelector(".b-video-controls__mymail-link");return!!e&&e?.href.split("my.mail.ru")?.[1]}return!1;case"bitchute":return t.pathname.match(/video\/([^/]+)/)?.[1];case"coursera":return t.pathname.match(/learn\/([^/]+)\/lecture\/([^/]+)/)?.[0];default:return!1}};function k(e){return e.toLowerCase().split(";")[0].trim().split("-")[0].split("_")[0]}function L(){return/^m\.youtube\.com$/.test(window.location.hostname)}function M(){return L()?document.querySelector("#app"):document.querySelector("#movie_player")}function F(){const e=M();return L()?e?.data?.playerResponse??null:e?.getPlayerResponse?.call()??null}function q(){const e=M();return L()?e?.data?.playerResponse?.videoDetails??null:e?.getVideoData?.call()??null}const D=function(){return document.querySelector(".html5-video-player")?.getVolume()/100},E=function(){const e=F();let t=e?.captions?.playerCaptionsTracklistRenderer?.captionTracks??[];return t=t.reduce(((e,t)=>{if("languageCode"in t){const n=t?.languageCode?k(t?.languageCode):void 0,o=t?.url||t?.baseUrl;n&&o&&e.push({source:"youtube",language:n,isAutoGenerated:"asr"===t?.kind,url:`${o.startsWith("http")?o:`${window.location.origin}/${o}`}&fmt=json3`})}return e}),[]),f.Z.log("youtube subtitles:",t),t},j=async function(){const e=M(),t=F(),n=q(),{author:o,title:a}=n??{},{shortDescription:r,isLive:i,isLiveContent:s,isUpcoming:l}=t?.videoDetails??{},u=!(!i&&!l||s);let d=await async function(e,t,n,o,a){if(!window.location.hostname.includes("m.youtube.com")){const t=e.getAudioTrack(),n=t?.getLanguageInfo();if("und"!==n?.id)return k(n.id.split(".")[0])}const r=t?.captions?.playerCaptionsTracklistRenderer?.captionTracks;if(r?.length){const e=r.find((e=>"asr"===e.kind));if(e&&e.languageCode)return k(e.languageCode)}const i=[n,o,a].join(" ").replace(/\s+/g," ").trim().replace(/https?:\/\/\S+/g,"").replace(/[^\p{L}\s]/gu,"").slice(0,250);return await async function(e){const t=await fetch("https://rust-server-531j.onrender.com/detect",{method:"POST",body:e});return await t.text()}(i)}(e,t,a,r,o);b.includes(d)||(d="en");const c={isLive:!!i,isPremiere:u,title:a,description:r,author:o,detectedLanguage:d};return f.Z.log("youtube video data:",c),console.log("[VOT] Detected language: ",c.detectedLanguage),c},A=function(e){return document.querySelector(".html5-video-player")?.setVolume(Math.round(100*e))},$=new protobuf.Type("VideoTranslationHelpObject").add(new protobuf.Field("target",1,"string")).add(new protobuf.Field("targetUrl",2,"string")),P=new protobuf.Type("VideoTranslationRequest").add(new protobuf.Field("url",3,"string")).add(new protobuf.Field("deviceId",4,"string")).add(new protobuf.Field("firstRequest",5,"bool")).add(new protobuf.Field("duration",6,"double")).add(new protobuf.Field("unknown2",7,"int32")).add(new protobuf.Field("language",8,"string")).add(new protobuf.Field("unknown3",9,"int32")).add(new protobuf.Field("unknown4",10,"int32")).add(new protobuf.Field("translationHelp",11,"VideoTranslationHelpObject","repeated")).add(new protobuf.Field("responseLanguage",14,"string")),C=new protobuf.Type("VideoSubtitlesRequest").add(new protobuf.Field("url",1,"string")).add(new protobuf.Field("language",2,"string")),Z=new protobuf.Type("VideoStreamRequest").add(new protobuf.Field("url",1,"string")).add(new protobuf.Field("language",2,"string")).add(new protobuf.Field("responseLanguage",3,"string")),I=new protobuf.Type("VideoStreamPingRequest").add(new protobuf.Field("pingId",1,"int32")),B=new protobuf.Type("VideoTranslationResponse").add(new protobuf.Field("url",1,"string")).add(new protobuf.Field("duration",2,"double")).add(new protobuf.Field("status",4,"int32")).add(new protobuf.Field("remainingTime",5,"int32")).add(new protobuf.Field("unknown0",6,"int32")).add(new protobuf.Field("unknown1",7,"string")).add(new protobuf.Field("language",8,"string")).add(new protobuf.Field("message",9,"string")),R=new protobuf.Type("VideoSubtitlesObject").add(new protobuf.Field("language",1,"string")).add(new protobuf.Field("url",2,"string")).add(new protobuf.Field("unknown2",3,"int32")).add(new protobuf.Field("translatedLanguage",4,"string")).add(new protobuf.Field("translatedUrl",5,"string")).add(new protobuf.Field("unknown5",6,"int32")).add(new protobuf.Field("unknown6",7,"int32")),_=new protobuf.Type("VideoSubtitlesResponse").add(new protobuf.Field("unknown0",1,"int32")).add(new protobuf.Field("subtitles",2,"VideoSubtitlesObject","repeated")),N=new protobuf.Type("VideoStreamObject").add(new protobuf.Field("url",1,"string")).add(new protobuf.Field("timestamp",2,"int32")),H=new protobuf.Type("VideoStreamResponse").add(new protobuf.Field("interval",1,"int32")).add(new protobuf.Field("translatedInfo",2,"VideoStreamObject")).add(new protobuf.Field("pingId",3,"int32")),U=(new protobuf.Root).define("yandex").add($).add(P).add(B).add(C).add(R).add(_).add(I).add(Z).add(N).add(H),z=(e,t,n,o,a)=>U.VideoTranslationRequest.encode({url:e,firstRequest:!0,duration:t,unknown2:1,language:n,unknown3:0,unknown4:0,translationHelp:a,responseLanguage:o}).finish(),W=e=>U.VideoTranslationResponse.decode(new Uint8Array(e)),Y=(e,t)=>U.VideoSubtitlesRequest.encode({url:e,language:t}).finish(),G=e=>U.VideoSubtitlesResponse.decode(new Uint8Array(e));var K=n("./src/config/config.js");const J=["invidious.snopyta.org","yewtu.be","invidious.kavin.rocks","vid.puffyan.us","invidious.namazso.eu","inv.riverside.rocks","yt.artemislena.eu","invidious.flokinet.to","invidious.esmailelbob.xyz","y.com.sb","invidious.nerdvpn.de","inv.vern.cc","invidious.slipfox.xyz","invidio.xamh.de","invidious.dhusch.de"],X=["piped.video","piped.tokhmi.xyz","piped.moomoo.me","piped.syncpundit.io","piped.mha.fi","watch.whatever.social","piped.garudalinux.org","efy.piped.pages.dev","watch.leptons.xyz","piped.lunar.icu","yt.dc09.ru","piped.mint.lgbt","il.ax","piped.privacy.com.de","piped.esmailelbob.xyz","piped.projectsegfau.lt","piped.in.projectsegfau.lt","piped.us.projectsegfau.lt","piped.privacydev.net","piped.palveluntarjoaja.eu","piped.smnz.de","piped.adminforge.de","piped.qdi.fi","piped.hostux.net","piped.chauvet.pro","piped.jotoma.de","piped.pfcd.me","piped.frontendfriendly.xyz"],Q=["proxitok.pabloferreiro.es","proxitok.pussthecat.org","tok.habedieeh.re","proxitok.esmailelbob.xyz","proxitok.privacydev.net","tok.artemislena.eu","tok.adminforge.de","tik.hostux.net","tt.vern.cc","cringe.whatever.social","proxitok.lunar.icu","proxitok.privacy.com.de"],ee=navigator.language||navigator.userLanguage;let te=ee?.substr(0,2)?.toLowerCase()??"en";function ne(e){document.querySelector(".translationBtn").style.color=e}function oe(e="none"){document.querySelector(".translationBtn").dataset.state=e}function ae(e="none"){let t;switch(e){case"error":t="#7A7A7D";break;case"success":t="#A36EFF";break;default:t="#FFFFFF"}document.querySelector(".translateIcon").style.fill=t}function re(e="none",t){switch(e){case"error":ae(e),ne("#7A7A7D"),oe(e);break;case"success":ae(e),ne("#A36EFF"),oe(e);break;default:ae("none"),ne("#FFFFFF"),oe("none")}document.querySelector(".translationBtn").innerText=t}function ie(e,t,n){const o=document.createElement("div"),a=document.createElement("input"),r=document.createElement("label");return a.type="checkbox",a.id=e,a.checked=Boolean(t),r.htmlFor=e,r.innerHTML=n,o.classList.add("translationMenuContainer"),o.appendChild(a),o.appendChild(r),o}function se(e,t,n,o=0,a=100){const r=document.createElement("div"),i=document.createElement("input"),s=document.createElement("label");return i.type="range",i.id=e,i.classList.add("VOTMenuSlider"),i.min=o,i.max=a,i.value=t,s.htmlFor=e,s.classList.add("translationHeader"),s.innerHTML=n,r.classList.add("translationMenuContainer"),r.appendChild(s),r.appendChild(i),r}function le(e,t){const n=document.createElement("div"),o=document.createElement("select");o.id=e,o.classList.add("VOTMenuSelect");for(const e of t){const t=document.createElement("option");t.innerText=e.label,t.value=e.value,Object.prototype.hasOwnProperty.call(e,"selected")&&e.selected&&t.setAttribute("selected","selected"),Object.prototype.hasOwnProperty.call(e,"disabled")&&(t.disabled=e.disabled),o.appendChild(t)}return n.classList.add("translationMenuContainer"),n.appendChild(o),n}function ue(e,t){console.log(e);const n=e.map((e=>({label:w.get("langs")[e]??e.toUpperCase(),value:e,selected:t===e})));return console.log(n),n}const de=4,ce=[{key:"settings",autoTranslate:0,defaultVolume:100,showVideoSlider:0,syncVolume:0,autoSetVolumeYandexStyle:1,dontTranslateYourLang:1},{audioProxy:0},{subtitlesMaxLength:300,highlightWords:0,responseLanguage:te},{udemyData:{accessToken:"",expires:0}}];function pe(e){return indexedDB.open(e,de)}async function me(){return new Promise(((e,t)=>{const n=pe("VOT");n.onerror=()=>{console.error(`[VOT] ${w.getDefault("VOTFailedInitDB")}: ${n.error.message}`),t(!1)},n.onupgradeneeded=o=>{const a=n.result;if(a.onerror=()=>{console.error(`[VOT] ${w.getDefault("VOTFailedInitDB")}`,n.error),alert(`[VOT] ${w.get("VOTFailedInitDB")}`),t(!1)},o.oldVersion<1){const n=Object.assign({},...ce.filter(((e,t)=>t>o.oldVersion-1&&t<=o.newVersion-1))),r=a.createObjectStore("settings",{keyPath:"key"});for(const e of Object.keys(n).filter((e=>"key"!==e)))r.createIndex(e,e,{unique:!1});return console.log("[VOT] Database Created"),void(r.transaction.oncomplete=()=>{const o=a.transaction("settings","readwrite").objectStore("settings").add(n);o.onsuccess=()=>{console.log("[VOT] Standard settings added to the Database: ",o.result),e(!0)},o.onerror=()=>{console.log("[VOT] Error when adding standard settings to the Database: ",o.error),t(!1)}})}!function(n,o,a,r={}){const i=n.objectStore("settings");for(const e of Object.keys(a))i.createIndex(e,e,{unique:!1});console.log("[VOT] The database has been updated"),i.transaction.oncomplete=()=>{const n=o.transaction("settings","readwrite").objectStore("settings"),i=n.get("settings");i.onerror=e=>{console.error("[VOT] Data could not be retrieved from the Database: ",e.error),t(!1)},i.onsuccess=()=>{const o=i.result||Object.assign(ce[0],r);for(const e in a)o[e]=a[e];const s=n.put(o);s.onerror=e=>{console.error("[VOT] Failed to update the Database to new version",e.error),t(!1)},s.onsuccess=()=>{console.log("[VOT] Standard settings of the new version have been added to the Database."),e(!0)}}}}(n.transaction,a,Object.assign({},...ce.filter(((e,t)=>t>o.oldVersion-1&&t<=o.newVersion-1))))},n.onsuccess=()=>{const o=n.result;o.onversionchange=()=>{o.close(),console.log(`[VOT] ${w.getDefault("VOTDBNeedUpdate")}`),alert(`[VOT] ${w.get("VOTDBNeedUpdate")}`),window.location.reload(),t(!1)},e(!0)},n.onblocked=()=>{const e=n.result;console.error(`[VOT] ${w.getDefault("VOTDisabledForDBUpdating").format(window.location.hostname)}`,e),alert(`[VOT] ${w.get("VOTDisabledForDBUpdating").format(window.location.hostname)}`),t(!1)}}))}async function ge({autoTranslate:e,defaultVolume:t,showVideoSlider:n,syncVolume:o,autoSetVolumeYandexStyle:a,dontTranslateYourLang:r,audioProxy:i,subtitlesMaxLength:s,highlightWords:l,responseLanguage:u,udemyData:d}){return new Promise(((c,p)=>{if("number"==typeof e||"number"==typeof t||"number"==typeof n||"number"==typeof o||"number"==typeof a||"number"==typeof r||"number"==typeof i||"number"==typeof s||"number"==typeof l||"string"==typeof u||"object"==typeof d){const m=pe("VOT");m.onerror=()=>{console.error(`[VOT] ${w.getDefault("VOTFailedWriteToDB")}`,m.error.message),alert(`[VOT] ${w.get("VOTFailedWriteToDB")}`),p(!1)},m.onupgradeneeded=async()=>{m.result.close(),await me(),c(!0)},m.onsuccess=()=>{const g=m.result;g.onversionchange=()=>{g.close(),console.log("[VOT] The database needs an update, please reload the page if it didn't happen automatically"),window.location.reload(),p(!1)};const h=g.transaction("settings","readwrite").objectStore("settings"),f=h.get("settings");f.onerror=e=>{console.error("[VOT] Data could not be retrieved from the Database: ",e.error),p(!1)},f.onsuccess=()=>{const m=f.result;"number"==typeof e&&(m.autoTranslate=e),"number"==typeof t&&(m.defaultVolume=t),"number"==typeof n&&(m.showVideoSlider=n),"number"==typeof o&&(m.syncVolume=o),"number"==typeof a&&(m.autoSetVolumeYandexStyle=a),"number"==typeof r&&(m.dontTranslateYourLang=r),"number"==typeof i&&(m.audioProxy=i),"number"==typeof s&&(m.subtitlesMaxLength=s),"number"==typeof l&&(m.highlightWords=l),"string"==typeof u&&(m.responseLanguage=u),"object"==typeof d&&(m.udemyData=d);const g=h.put(m);g.onerror=e=>{console.error("[VOT] failed update db data: ",e.error),p(!1)},g.onsuccess=()=>{c(!0)}}},m.onblocked=()=>{const e=m.result;console.error(`[VOT] ${w.getDefault("VOTDisabledForDBUpdating").format(window.location.hostname)}`,e),alert(`[VOT] ${w.get("VOTDisabledForDBUpdating").format(window.location.hostname)}`),p(!1)}}}))}function he(){indexedDB.deleteDatabase("VOT")}function fe(e,t,n,o){let a;return t>o?(a=n+(t-o),a=a>100?100:Math.max(a,0),e.volume=a/100):t<o&&(a=n-(o-t),a=a>100?100:Math.max(a,0),e.volume=a/100),a}const we={youtubeRegex:/^(www.|m.)?youtube(-nocookie)?.com$/},ye=".html5-video-container",be=".video-ref",ve="main > div > section > div > div > div",Te=".shaka-video-container",Ve=".videoplayer_media",Se='div[data-testid="videoComponent"] > div:nth-child(1) > div',Oe=".player",xe=".video-post",ke=".bpx-player-video-wrap",Le="#b-video-wrapper",Me="#video_player",Fe=".vjs-v7",qe="video",De=".column.has-text-centered";function Ee(e){const t=([1e7]+1e3+4e3+8e3+1e11).replace(/[018]/g,(e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)));return e?t:t.toUpperCase()}async function je(e){const t=new TextEncoder("utf-8"),n=await window.crypto.subtle.importKey("raw",t.encode(K.I1),{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign","verify"]),o=await window.crypto.subtle.sign("HMAC",n,e);return Array.from(new Uint8Array(o),(e=>e.toString(16).padStart(2,"0"))).join("")}function Ae(e){const t=e.startMs+e.durationMs;return e.tokens.reduce(((n,o,a)=>{const r=e.tokens[a+1],i=n[n.length-1],s=i?.alignRange?.end??0,l=s+o.text.length;if(n.push(Object.assign(Object.assign({},o),{alignRange:{start:s,end:l}})),r){const e=o.startMs+o.durationMs,a=r.startMs?r.startMs-e:t-e;n.push({text:" ",startMs:e,durationMs:a,alignRange:{start:l,end:l+1}})}return n}),[])}function $e(e,t){const n=e.text.split(new RegExp("([\n \t])")).reduce(((e,n)=>{if(n.length){const o=e[e.length-1]??t,a=o?.alignRange?.end??0,r=a+n.length;e.push({text:n,alignRange:{start:a,end:r}})}return e}),[]),o=Math.floor(e.durationMs/n.length),a=e.startMs+e.durationMs;return n.map(((t,r)=>{const i=r===n.length-1,s=e.startMs+o*r,l=i?a-s:o;return Object.assign(Object.assign({},t),{startMs:s,durationMs:l})}))}var Pe=null;function Ce(e){if(e.querySelector(".VOTSubtitlesWidget"))return;const t=document.createElement("div");t.classList.add("VOTSubtitlesWidget"),e.appendChild(t),Pe=t;let n,o,a,r,i=!1;document.addEventListener("mousedown",(function(s){t.contains(s.target)&&(n=t.getBoundingClientRect(),o=e.getBoundingClientRect(),a=s.clientX-n.x,r=s.clientY-n.y,i=!0)})),document.addEventListener("mouseup",(function(){i=!1})),document.addEventListener("mousemove",(function(e){if(i){e.preventDefault();const i=e.clientX-a,s=e.clientY-r,l=s>=o.top,u=s+n.height<=o.bottom,d=i>=o.left,c=i+n.width<=o.right;t.style.top=l&&u?s-o.y+"px":l?o.height-n.height+"px":"0px",t.style.left=d&&c?i-o.x+"px":d?o.width-n.width+"px":"0px"}}))}var Ze=null,Ie=null,Be=null,Re=300,_e=/.{1,300}(?:\s|$)/g,Ne=!1;function He(e){if(!e)return;let t="",n=Ne&&Ze?.containsTokens;const o=1e3*e.currentTime,a=Ze?.subtitles?.findLast((e=>e.startMs<o&&o<e.startMs+e.durationMs));if(a)if(n){let e=a.tokens;if(e.at(-1).alignRange.end>Re){let t=[],n=0,a=0,r=0;for(let o=0;o<e.length+1;o++){if(r+=e[o]?.text?.length??0,!e[o]||r>Re){let i=e.slice(n,a+1);i.at(0)&&" "===i.at(0).text&&(i=i.slice(1)),i.at(-1)&&" "===i.at(-1).text&&(i=i.slice(0,i.length-1)),t.push({startMs:e[n].startMs,durationMs:e[a].startMs+e[a].durationMs-e[n].startMs,tokens:i}),n=o,r=0}a=o}for(let n=0;n<t.length;n++)if(t[n].startMs<o&&o<t[n].startMs+t[n].durationMs){e=t[n].tokens;break}}for(let n of e){const e=n.startMs+n.durationMs/2;t+=`<span ${o>e||o>n.startMs-100&&e-o<275?'class="passed"':""}>${n.text}</span>`}}else if(a.text.length>Re){let e=a.text.match(_e),n=a.durationMs/e.length;for(let r=0;r<e.length;r++)if(a.startMs+n*r<o&&o<a.startMs+n*(r+1)){t=e[r].trim();break}}else t=a.text;t!==Be&&(Be=t,Pe.innerHTML=t?`<div>${t.replace("\\n","<br>")}</div>`:"")}function Ue(e){He(e.target)}function ze(e){"number"==typeof e&&e&&(Re=e,_e=new RegExp(`.{1,${e}}(?:\\s|$)`,"g"),He(Ie))}function We(e){Ne!==!!e&&(Ne=!!e,He(Ie))}function Ye(){return Ge()?.player}function Ge(){return document.querySelector("#video_player")}const Ke=async function(e="en"){let t=null;const n=Ye(),{duration:o}=n?.cache_||{},{courseId:a,tracks:r,sources:i}=n?.options_||{},s=function(e){const t=e.find((e=>"video/mp4"===e.type));return t?.src}(i),l=await async function(e){const t=await fetch(`https://www.coursera.org/api/onDemandCourses.v1/${e}`),n=await t.json();return n?.elements?.[0]}(a);let u=l?.primaryLanguageCodes?.[0];u=u?k(u):"en",b.includes(u)||(u="en");const d=function(e,t){const n=t.find((t=>k(t.srclang)===e));return n?.src}(e,r);d&&(t=[{target:"video_file_url",targetUrl:s},{target:"subtitles_file_url",targetUrl:`https://www.coursera.org${d}`}]);const c={duration:o,detectedLanguage:u,translationHelp:t};return f.Z.log("coursera video data:",c),console.log("[VOT] Detected language: ",c.detectedLanguage),c},Je="https://www.udemy.com/api-2.0";async function Xe(e){const t=await fetch(`${Je}/courses/${e}/?`+new URLSearchParams({"fields[course]":"locale",use_remote_version:"true",caching_intent:"true"}));return await t.json()}async function Qe(e,t,n){if(!(e.expires+2592e3>(new Date).getTime()&&e.accessToken))return void console.error(w.get("udemyAccessTokenExpired"));const o=`Bearer ${e.accessToken}`,a=await fetch(`${Je}/users/me/subscribed-courses/${t}/lectures/${n}/?`+new URLSearchParams({"fields[lecture]":"asset","fields[asset]":"length,media_sources,captions"}),{headers:{"x-udemy-authorization":o,authorization:o}});return await a.json()}function et(){return nt()?.player}function tt(){const e=document.querySelector(".ud-app-loader[data-module-id='course-taking']")?.dataset?.moduleArgs;return e?JSON.parse(e):(console.error(w.get("udemyModuleArgsNotFound")),{})}function nt(){return document.querySelector(".vjs-v7")}const ot=async function(e,t="en"){let n=null;const o=et();f.Z.log("udemyData",e);const a=tt();f.Z.log("moduleData: ",a);const r=a.courseId,i=window.location.pathname.match(/learn\/lecture\/([^/]+)/)?.[1];f.Z.log(`CourseId: ${r}, lectureId: ${i}`);const s=await Xe(r);f.Z.log("courseLang Data:",s);const l=await Qe(e,r,i);f.Z.log("lecture Data:",l);let u=s?.locale?.locale;u=u?k(u):"en",b.includes(u)||(u="en");const d=l?.asset?.length||o?.cache_?.duration,c=function(e){const t=e?.find((e=>"video/mp4"===e.type));return t?.src}(l?.asset?.media_sources),p=function(e,t){const n=e?.find((e=>k(e.locale_id)===t));return n?.url}(l?.asset?.captions,t);f.Z.log(`videoURL: ${c}, subtitlesURL: ${p}`),p&&c&&(n=[{target:"video_file_url",targetUrl:c},{target:"subtitles_file_url",targetUrl:p}]);const m={duration:d,detectedLanguage:u,translationHelp:n};return f.Z.log("udemy video data:",m),console.log("[VOT] Detected language: ",m.detectedLanguage),m},at=[...J,...X];let rt=te,it="",st=[],lt=null;async function ut(){if(f.Z.log("Loading extension..."),f.Z.log(`Selected menu language: ${te}`),GM_info?.scriptHandler&&V.includes(GM_info.scriptHandler))return console.error(`[VOT] ${w.getDefault("unSupportedExtensionError").format(GM_info.scriptHandler)}`),alert(`[VOT] ${w.get("unSupportedExtensionError").format(GM_info.scriptHandler)}`);let e;f.Z.log("Extension compatibility passed...");const t=new Audio;let o=.9,a=!1;function r(e){a||(document.querySelector(".translationBlock").style.opacity=e)}function i(){clearTimeout(e),r(1),e=setTimeout((()=>{r(0)}),2e3)}function s(e,t,n){clearTimeout(t),r(n),e.stopPropagation()}function l(e,t,o,a,r,i){f.Z.log(`Translate video (url: ${e}, duration: ${t}, requestLang: ${o}, responseLang: ${a})`),f.Z.log("translationHelp:",r),async function(e,t,o,a,r,i){try{f.Z.log("requestVideoTranslation");const s=(await Promise.resolve().then(n.bind(n,"./src/yandexRequest.js"))).default;f.Z.log("Inited yandexRequest...");const l=z(e,t,o,a,r);await s("/video-translation/translate",l,{"Vtrans-Signature":await je(l),"Sec-Vtrans-Token":Ee(!1)},i)}catch(e){console.error("[VOT]",e),i(!1)}}(e,t,o,a,r,((e,t)=>{if(f.Z.log("[exec callback] Requesting video translation"),!e)return void i(!1,w.get("requestTranslationFailed"));const n=W(t);switch(console.log("[VOT] Translation response: ",n),n.status){case 0:i(!1,n.message);break;case 1:i(!!n.url,n.url||w.get("audioNotReceived"));break;case 2:i(!1,n.remainingTime?function(e){const t=Math.floor(e/60),n=Math.floor(e%60);return t>=60?w.get("translationTakeMoreThanHour"):t>=10&&t%10?w.get("translationTakeApproximatelyMinutes").format(t):1==t||0==t&&n>0?w.get("translationTakeAboutMinute"):w.get("translationTakeApproximatelyMinute").format(t)}(n.remainingTime):w.get("translationTakeFewMinutes"));break;case 3:i(!1,w.get("videoBeingTranslated"))}}))}async function u(u,d,c){let p,m,g,h,V,S,k,L,M,F,q,$,P,C,Z,I;f.Z.log("[translateProccessor] execute on element: ",u);let B,R=!0,_="";f.Z.log("videoContainer",u),p="vimeo"===d?u.querySelector(".vp-video-wrapper > .vp-video > .vp-telecine > video"):u.querySelector("video"),f.Z.log("video",p);const N="pornhub"===d&&window.location.pathname.includes("view_video.php")?document.querySelector(".original.mainPlayerDiv"):"pornhub"===d&&window.location.pathname.includes("embed/")?document.querySelector("body"):window.location.hostname.includes("m.youtube.com")?document.querySelector("#player-control-container"):u;!function(e){if(!e||e.querySelector(".translationBlock"))return;const t=document.createElement("div");t.classList.add("translationBlock"),t.innerHTML=`\n    <span class = "translationArea" role = "button">\n      <span class = "translationITranslate" tabindex = "-1">\n        <svg class="translateIcon" width="24" height="24" viewBox="0 0 32 32" fill="#fff" xmlns="http://www.w3.org/2000/svg">\n          <path fill-rule="evenodd" clip-rule="evenodd" d="M17.605 19.703c.794-.13 1.647-.476 2.47-.983.695 1.013 1.255 1.546 1.306 1.593l1.166-1.207c-.011-.01-.504-.48-1.124-1.401.277-.25.547-.512.797-.798a12.1 12.1 0 0 0 2.268-3.826c.383.216.761.541.96 1.027.68 1.649-.301 3.557-1.215 4.385l1.152 1.22c1.52-1.378 2.571-3.959 1.638-6.227-.368-.892-1.077-1.59-2.064-2.037.162-.763.216-1.38.233-1.785h-1.698c-.017.307-.06.762-.173 1.323-1.325-.187-2.818-.006-4.248.508a25.994 25.994 0 0 1-.313-2.547c5.092-.287 8.098-1.488 8.237-1.546l-.654-1.533c-.03.013-2.875 1.14-7.65 1.418-.001-.405-.008-.666-.012-.85-.008-.339-.01-.423.03-.67L17.01 5.75c-.026.283-.024.573-.018 1.278l.002.318c-.026 0-.051 0-.077.002l-.08.001a39.286 39.286 0 0 1-3.27-.14L13.25 8.89c.5.043 2.023.122 3.397.122h.1a19.457 19.457 0 0 1 .208-.003l.106-.002c.067.948.196 2.034.421 3.22a8.05 8.05 0 0 0-2.267 1.963l.811 1.871c.327-.732.995-1.51 1.856-2.111a16.762 16.762 0 0 0 1.33 3.346c-.811.514-1.64.818-2.301.804l.694 1.603Zm2.953-3.488a8.18 8.18 0 0 0 .374-.389 10.465 10.465 0 0 0 1.927-3.224c-.198-.021-.4-.031-.606-.031-.907 0-1.885.199-2.834.574.31 1.209.718 2.23 1.14 3.07ZM9.769 11.688 4.25 24.438h2.259l1.357-3.407h5.582l1.357 3.407h2.258l-5.52-12.75H9.77Zm.887 2.624 2.056 5H8.6l2.056-5Z"></path>\n        </svg>\n      </span>\n      <span class = "translationBtn" tabindex = "0">${w.get("translateVideo")}</span>\n    </span>\n    <span class = "translationMenu" tabindex = "0" role = "button">\n      <svg class = "translationMenuIcon" height="15" width="5" fill="#fff" xmlns="http://www.w3.org/2000/svg">\n        <path d="M3.5 1.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0ZM3.5 7.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0ZM3.5 13.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0Z"></path>\n      </svg>\n    </span>\n  `,e.appendChild(t),f.Z.log("Added translation button to ",e)}(N),function(e){if(e.querySelector(".translationMenuContent"))return;const t=function(){const e=document.createElement("div");return e.classList.add("translationMenuContent"),e.innerHTML=`\n    <p class = "translationMainHeader">${w.get("translationSettings")}</p>\n    <div class="translationMenuOptions"></div>\n    <div class="translationMenuFunctional">\n      <a class = "translationDownload">\n        <svg width="24px" height="24px" data-darkreader-inline-stroke="" fill="none" stroke="currentColor" style="--darkreader-inline-stroke: currentColor;" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>\n        </svg>\n      </a>\n      <button class = "translationDropDB">${w.get("resetSettings")}</button>\n    </div>\n  `,e.onclick=e=>e.stopPropagation(),e}();e.appendChild(t),document.querySelector(".translationMenu")?.addEventListener("click",(e=>{e.stopPropagation();const t=document.querySelector(".translationMenuContent");t.style.display=a?"none":"block",t.style.opacity=o,a=!a})),document.querySelector(".translationDropDB").addEventListener("click",(e=>{e.stopPropagation(),he(),location.reload()})),f.Z.log("Added translation menu to ",e)}(N),window.location.hostname.includes("youtube.com")&&!window.location.hostname.includes("m.youtube.com")?Ce(N.parentElement):Ce(N),await U("disabled");try{B=await me()}catch(e){console.error("[VOT] Failed to initialize database settings. All changes made will not be saved",e)}const H=document.querySelector(".translationMenuOptions");if(H&&!H.querySelector("#VOTTranslateFromLang")){const e=[{label:w.get("videoLanguage"),value:"default",disabled:!0},...ue(b,_.detectedLanguage)],t=[{label:w.get("translationLanguage"),value:"default",disabled:!0},...ue(b,_.responseLanguage),{label:"─────────",value:"separator",disabled:!0},...ue(v,_.responseLanguage)],n=le("VOTTranslateFromLang",e),o=le("VOTTranslateToLang",t).firstElementChild;n.id="VOTSelectLanguages",n.innerHTML+='\n        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">\n          <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12h16m0 0l-6 6m6-6l-6-6"/>\n        </svg>\n      ',n.appendChild(o),H.appendChild(n),H.querySelector("#VOTTranslateFromLang").addEventListener("change",(async e=>{f.Z.log("[onchange] select from language",e.target.value),_=await ne(),await W(e.target.value,_.responseLanguage)})),H.querySelector("#VOTTranslateToLang").addEventListener("change",(async e=>{f.Z.log("[onchange] select to language",e.target.value),B&&(rt=e.target.value,await ge({responseLanguage:e.target.value}),f.Z.log("Response Language value changed. New value: ",e.target.value)),_=await ne(),await W(_.detectedLanguage,e.target.value)}))}async function U(e){f.Z.log("[onchange] subtitles",e);const t=document.querySelector(".translationMenuOptions")?.querySelector("#VOTSubtitlesLang");if(t&&(t.value=e),!p)return console.error("[VOT] video not found"),void(t&&(t.value="disabled"));!function(e,t){t&&e?(Ze=t,Ie=e,e?.addEventListener("timeupdate",Ue),He(e)):(Ze=null,e?.removeEventListener("timeupdate",Ue),Pe.innerHTML="")}(p,"disabled"===e?null:await async function(e){let t=!1,n=await Promise.race([new Promise((async e=>{await O(5e3),t||console.error("[VOT] Failed to fetch subtitles. Reason: timeout"),t=!0,e([])})),new Promise((async n=>{f.Z.log("Fetching subtitles:",e),await fetch(e.url).then((e=>e.json())).then((e=>{t=!0,n(e)})).catch((e=>{console.error("[VOT] Failed to fetch subtitles. Reason:",e),t=!0,n({containsTokens:!1,subtitles:[]})}))}))]);return"youtube"===e.source&&(n=function(e){const t={containsTokens:!1,subtitles:[]};if("object"!=typeof e||!("events"in e)||!Array.isArray(e.events))return console.error("[VOT] Failed to format youtube subtitles",e),t;for(let n=0;n<e.events.length;n++){if(!e.events[n].segs)continue;const o=e.events[n].segs.map((e=>e.utf8.replace(/^ +| +$/g,""))).join(" ");let a=e.events[n].dDurationMs;e.events[n+1]&&e.events[n].tStartMs+e.events[n].dDurationMs>e.events[n+1].tStartMs&&(a=e.events[n+1].tStartMs-e.events[n].tStartMs),"\n"!==o&&t.subtitles.push({text:o,startMs:e.events[n].tStartMs,durationMs:a})}return t}(n)),n.subtitles=function(e,t){const n=[];let o;for(const a of e.subtitles){let r;if(a?.tokens?.length){if("yandex"!==t)return console.warn("[VOT] Unsupported subtitles tokens type: ",t),e.containsTokens=!1,null;r=Ae(a)}else r=$e(a,o);o=r[r.length-1],n.push(Object.assign(Object.assign({},a),{tokens:r}))}return e.containsTokens=!0,n}(n,e.source),console.log("[VOT] subtitles:",n),n}(st.at(parseInt(e))))}async function z(){const e=document.querySelector(".translationMenuOptions")?.querySelector("#VOTSubtitlesLang");if(!e)return void console.error("[VOT] #VOTSubtitlesLang not found");const t=e.value;e.innerHTML="";const n=document.createElement("option");n.value="disabled",n.innerHTML=w.get("VOTSubtitlesDisabled"),e.append(n);for(let t=0;t<st.length;t++){const n=st[t],o=document.createElement("option");o.value=t,o.innerHTML=(w.get("langs")[n.language]??n.language.toUpperCase())+(n.translatedFromLanguage?` ${w.get("VOTTranslatedFrom")} ${w.get("langs")[n.translatedFromLanguage]??n.translatedFromLanguage.toUpperCase()}`:"")+("yandex"!==n.source?` ${n.source}`:"")+(n.isAutoGenerated?` (${w.get("VOTAutogenerated")})`:""),e.append(o)}await U(t)}if(H&&!H.querySelector("#VOTSubtitlesLang")){const e=le("VOTSubtitlesLang",[{label:w.get("VOTSubtitlesDisabled"),value:"disabled",disabled:!1}]);e.id="VOTSubtitlesLangContainer";const t=document.createElement("span");t.textContent=w.get("VOTSubtitles"),e.prepend(t),H.appendChild(e),H.querySelector("#VOTSubtitlesLang").addEventListener("change",(async e=>{await U(e.target.value)}))}if(B){const e=await async function(){return new Promise(((e,t)=>{const n=pe("VOT");n.onerror=()=>{console.error(`[VOT] ${w.getDefault("VOTFailedReadFromDB")}`,n.error.message),alert(`[VOT] ${w.get("VOTFailedReadFromDB")}`),t(!1)},n.onupgradeneeded=async()=>{n.result.close(),await me(),e(!0)},n.onsuccess=()=>{const o=n.result;o.onversionchange=()=>{o.close(),console.error(`[VOT] ${w.getDefault("VOTDBNeedUpdate")}`),alert(`[VOT] ${w.get("VOTDBNeedUpdate")}`),t(!1)};const a=o.transaction("settings").objectStore("settings").get("settings");a.onerror=e=>{console.error("[VOT]",w.getDefault("VOTFailedReadFromDB"),e.error),console.error("[VOT]",e),t(!1)},a.onsuccess=()=>{void 0===a.result&&(o.close(),he(),t(!1));const n=a.result;e(n)}},n.onblocked=()=>{const e=n.result;console.error(`[VOT] ${w.getDefault("VOTDisabledForDBUpdating").format(window.location.hostname)}`,e),alert(`[VOT] ${w.get("VOTDisabledForDBUpdating").format(window.location.hostname)}`),t(!1)}}))}();if(e){if(S=e.subtitlesMaxLength,k=e.highlightWords,L=e.autoTranslate,M=e.defaultVolume,F=e.showVideoSlider,q=e.autoSetVolumeYandexStyle,$=e.dontTranslateYourLang,Z=e.responseLanguage,I=e.audioProxy,P=e.syncVolume,C=e.udemyData,f.Z.log("[db] data from db: ",e),void 0!==S&&ze(S),void 0!==k&&We(k),void 0!==Z&&(_=await ne(),W(_.detectedLanguage,Z),rt=Z),void 0!==S&&H&&!H.querySelector("#VOTSubtitlesMaxLengthSlider")){const e=se("VOTSubtitlesMaxLengthSlider",S,`${w.get("VOTSubtitlesMaxLength")}: <b id="VOTSubtitlesMaxLengthValue">${S}</b>`,50,300);e.querySelector("#VOTSubtitlesMaxLengthSlider").oninput=async t=>{const n=Number(t.target.value);await ge({subtitlesMaxLength:n}),S=n,e.querySelector("#VOTSubtitlesMaxLengthValue").innerText=`${n}`,ze(n)},H.appendChild(e)}if(void 0!==k&&H&&!H.querySelector("#VOTHighlightWords")){const e=ie("VOTHighlightWords",k,w.get("VOTHighlightWords"));e.querySelector("#VOTHighlightWords").onclick=async e=>{e.stopPropagation();const t=Number(e.target.checked);await ge({highlightWords:t}),k=t,f.Z.log("highlightWords value changed. New value: ",k),We(t)},H.appendChild(e)}if(void 0!==L&&H&&!H.querySelector("#VOTAutoTranslate")){const e=ie("VOTAutoTranslate",L,w.get("VOTAutoTranslate")+("vk"===d||window.location.hostname.includes("m.twitch.tv")?` <strong>(${w.get("recommended")})</strong>`:""));e.querySelector("#VOTAutoTranslate").onclick=async e=>{e.stopPropagation();const t=Number(e.target.checked);await ge({autoTranslate:t}),L=t,f.Z.log("autoTranslate value changed. New value: ",L)},H.appendChild(e)}if(window.location.hostname.includes("youtube.com")&&void 0!==$&&H&&!H.querySelector("#VOTDontTranslateYourLang")){const e=ie("VOTDontTranslateYourLang",$,w.get("VOTDontTranslateYourLang"));e.querySelector("#VOTDontTranslateYourLang").onclick=async e=>{e.stopPropagation();const t=Number(e.target.checked);await ge({dontTranslateYourLang:t}),$=t,f.Z.log("dontTranslateYourLang value changed. New value: ",$)},H.appendChild(e)}if(void 0!==q&&H&&!H.querySelector("#VOTAutoSetVolume")){const e=ie("VOTAutoSetVolume",q,w.get("VOTAutoSetVolume")+(100*K.IM+"%"));e.querySelector("#VOTAutoSetVolume").onclick=async e=>{e.stopPropagation();const t=Number(e.target.checked);await ge({autoSetVolumeYandexStyle:t}),q=t,f.Z.log("autoSetVolumeYandexStyle value changed. New value: ",q)},H.appendChild(e)}if(void 0!==F&&H&&!H.querySelector("#VOTShowVideoSlider")){const e=ie("VOTShowVideoSlider",F,w.get("VOTShowVideoSlider"));e.querySelector("#VOTShowVideoSlider").onclick=async e=>{e.stopPropagation();const t=Number(e.target.checked);await ge({showVideoSlider:t}),F=t,f.Z.log("showVideoSlider value changed. New value: ",F),1===F&&"success"===document.querySelector(".translationBtn").dataset.state?ae():document.querySelector("#VOTVideoSlider")?.parentElement.remove()},H.appendChild(e)}if(window.location.hostname.includes("youtube.com")&&!window.location.hostname.includes("m.youtube.com")&&void 0!==P&&H&&!H.querySelector("#VOTSyncVolume")){const e=ie("VOTSyncVolume",P,w.get("VOTSyncVolume"));e.querySelector("#VOTSyncVolume").onclick=async e=>{e.stopPropagation();const t=Number(e.target.checked);await ge({syncVolume:t}),P=t,f.Z.log("syncVolume value changed. New value: ",P)},H.appendChild(e)}if(window.location.hostname.includes("udemy.com")&&void 0!==C&&H&&!H.querySelector("#VOTUdemyData")){const e=document.createElement("button");e.classList.add("translationUdemyData"),e.innerText=w.get("VOTUdemyData"),e.onclick=async e=>{e.stopPropagation();const t={accessToken:prompt(w.get("enterUdemyAccessToken")),expires:(new Date).getTime()};await ge({udemyData:t}),C=t,f.Z.log("udemyData value changed. New value: ",C),window.location.reload()},H.appendChild(e)}}}if(re("none",w.get("translateVideo")),window.location.hostname.includes("youtube.com")&&!window.location.hostname.includes("m.youtube.com")){const e=new MutationObserver((async function(e){e.forEach((async function(e){"attributes"===e.type&&"aria-valuenow"===e.attributeName&&document.querySelector("#VOTVideoSlider")&&X()}))})),t=document.querySelector(".ytp-volume-panel");t&&e.observe(t,{attributes:!0,childList:!1,subtree:!0,attributeOldValue:!0})}async function W(e,t){document.querySelector("#VOTSelectLanguages")&&(document.querySelector("#VOTTranslateFromLang").value=e,document.querySelector("#VOTTranslateToLang").value=t,console.log(`[VOT] Set translation from ${e} to ${t}`),_.detectedLanguage=e,_.responseLanguage=t)}async function J(){t.pause(),p.removeEventListener(".translate",J,!1),await(async()=>{t.src="",t.removeAttribute("src")})(),document.querySelector("#VOTVideoSlider")?.parentElement.remove(),document.querySelector("#VOTTranslationSlider")?.parentElement.remove();const e=document.querySelector(".translationDownload");e&&(e.href="",e.style.display="none"),re("none",w.get("translateVideo")),g&&(f.Z.log(`Volume on start: ${g}`),window.location.hostname.includes("youtube.com")?document.querySelector(".html5-video-player").setVolume(100*g):p.volume=g)}async function X(){const e=Math.round(100*Q()),t=document.querySelector("#VOTVideoSlider");if(!t)return;t.value=e;const n=document.querySelector("#VOTOriginalVolume");n&&(n.innerText=`${e}%`),1===P&&(h=Number(e))}function Q(){let e=p?.volume;return window.location.hostname.includes("youtube.com")&&(e=D()||e),e}function ee(e){if(window.location.hostname.includes("youtube.com"))return A(e);p.volume=e}async function ne(){const e={translationHelp:null};if(e.duration=p?.duration||343,e.videoId=x(d),e.detectedLanguage="en",e.responseLanguage=rt,window.location.hostname.includes("youtube.com"))it=await j(),""!==it.author&&(e.detectedLanguage=it.detectedLanguage,e.responseLanguage=rt);else if(window.location.hostname.includes("rutube")||window.location.hostname.includes("my.mail.ru"))e.detectedLanguage="ru";else if(window.location.hostname.includes("bilibili.com"))e.detectedLanguage="zh";else if(window.location.hostname.includes("coursera.org")){const t=await Ke(rt);e.duration=t.duration||e.duration,e.detectedLanguage=t.detectedLanguage,e.translationHelp=t.translationHelp}else if(window.location.hostname.includes("udemy.com")){const t=await ot(C,rt);e.duration=t.duration||e.duration,e.detectedLanguage=t.detectedLanguage,e.translationHelp=t.translationHelp}return e}const oe=async(e=!1)=>{if(f.Z.log("lipsync video",p),p)if(t.currentTime=p.currentTime,t.playbackRate=p.playbackRate,e)if("play"!==e)"pause"===e&&(f.Z.log("lipsync mode is pause"),t.pause()),"stop"===e&&(f.Z.log("lipsync mode is stop"),t.pause()),"waiting"===e&&(f.Z.log("lipsync mode is waiting"),t.pause()),"playing"===e&&(f.Z.log("lipsync mode is playing"),t.play());else{f.Z.log("lipsync mode is play");const e=t.play();void 0!==e&&e.catch((e=>{if(console.error("[VOT]",e),"NotAllowedError"===e.name)throw re("error",w.get("grantPermissionToAutoPlay")),new y("grantPermissionToAutoPlay");if("NotSupportedError"===e.name)throw re("error",at.includes(window.location.hostname)?w.get("neededAdditionalExtension"):w.get("audioFormatNotSupported")),at.includes(window.location.hostname)?new y("neededAdditionalExtension"):new y("audioFormatNotSupported")}))}else f.Z.log("lipsync mode is not set")};function ae(){if(1!==F||document.querySelector("#VOTVideoSlider")||"success"!==document.querySelector(".translationBtn").dataset.state)return;const e=100*Q();h=e;const n=se("VOTVideoSlider",e,`${w.get("VOTVolume")}: <b class = "volumePercent" id="VOTOriginalVolume">${e}%</b>`);n.querySelector("#VOTVideoSlider").oninput=async e=>{const{value:o}=e.target;if(ee(o/100),n.querySelector("#VOTOriginalVolume").innerText=`${o}%`,1!==P)return;const a=document.querySelector("#VOTTranslationSlider");if(!a)return;const r=Number(a.value),i=fe(t,o,r,h);a.value=i;const s=document.querySelector("#VOTTranslationVolume");s&&(s.innerText=`${i}%`),V=i,h=o},document.querySelector(".translationMenuOptions").appendChild(n)}const de=async e=>{_.detectedLanguage||(_=await ne(),await W(_.detectedLanguage,_.responseLanguage)),f.Z.log("Run videoValidator"),await async function(){if(window.location.hostname.includes("youtube.com")){if(f.Z.log("VideoValidator videoData: ",_),1===$&&_.detectedLanguage===te&&_.responseLanguage===te)throw new y("VOTDisableFromYourLang");if(it.isPremiere)throw new y("VOTPremiere");if(it.isLive)throw new y("VOTLiveNotSupported");if(_.duration>14400)throw new y("VOTVideoIsTooLong")}return!0}(),f.Z.log("Run translateFunc"),await ye(e,_.detectedLanguage,_.responseLanguage,_.translationHelp)};async function ce(e){f.Z.log(`video ${e.type}`),await oe(e.type)}async function we(){await J(),await X()}async function ye(e,n,o,a){console.log("[VOT] Video Data: ",_);const r=`${T[d]}${e}`;if(["udemy","coursera"].includes(d)&&!a)throw new y("VOTTranslationHelpNull");l(r,_.duration,n,o,a,(async(r,i)=>{if(f.Z.log("[exec callback] translateVideo"),x(d)!==e)return;if(!r)throw re("error","VOTLocalizedError"===i?.name?i.localizedMessage:i),i.includes(w.get("translationTake"))&&(clearTimeout(m),m=setTimeout((()=>ye(e,n,o,a)),6e4)),i;switch(t.src=i,g=Q(),"number"==typeof M&&(t.volume=M/100),"number"==typeof q&&q&&ee(K.IM),d){case"twitter":document.querySelector('div[data-testid="app-bar-back"][role="button"]').addEventListener("click",we);break;case"invidious":case"piped":break;default:null!==c&&document.body.addEventListener(c,we)}const s=["twitch","vimeo","facebook","rutube","twitter","bilibili.com","mail.ru"];for(let e=0;e<s.length;e++)if(d===s[e]){new MutationObserver((async e=>{e.forEach((async e=>{"attributes"===e.type&&"src"===e.attributeName&&e.target===p&&""!==e.target.src&&(we(),R=!0)}))})).observe(u,{attributes:!0,childList:!1,subtree:!0,attributeOldValue:!0});break}p&&!p.paused&&oe("play");const l=document.querySelectorAll("video"),y=["playing","ratechange","play","waiting","pause"];l.forEach((e=>y.forEach((t=>e.addEventListener(t,ce))))),re("success",w.get("disableTranslate")),ae(),await async function(){if(document.querySelector("#VOTTranslationSlider")||"success"!==document.querySelector(".translationBtn").dataset.state)return;const e="number"==typeof M?M:100;h=e;const n=se("VOTTranslationSlider",e,`${w.get("VOTVolumeTranslation")}: <b class = "volumePercent" id="VOTTranslationVolume">${e}%</b>`);n.querySelector("#VOTTranslationSlider").oninput=async({target:{value:e}})=>{t.volume=e/100,document.querySelector("#VOTTranslationVolume").innerText=`${e}%`,await ge({defaultVolume:Number(e)}),M=Number(e),1===P&&function(e){const t=document.querySelector("#VOTVideoSlider");if(!t)return;const n=Number(t.value),o=fe(p,e,n,V);t.value=o;const a=document.querySelector("#VOTOriginalVolume");a&&(a.innerText=`${o}%`),h=o,V=e}(e)},document.querySelector(".translationMenuOptions").appendChild(n)}();const b=document.querySelector("#VOTVideoSlider");b&&(b.value=100*K.IM);const v=document.querySelector("#VOTOriginalVolume");v&&(v.innerText=100*K.IM+"%");const T=document.querySelector(".translationDownload");T.href=i,T.style.display="initial"}))}document.addEventListener("click",(async e=>{const t=document.querySelector(".translationBlock"),n=document.querySelector(".translationMenuContent"),o=!(!t&&e.target!==t)&&t.contains(e.target),i=!(!n&&e.target!==n)&&n.contains(e.target),s=!(!u&&e.target!==u)&&u.contains(e.target);f.Z.log(`[document click] ${o} ${i} ${s}`),o||i||(s||r(0),n.style.display="none",a=!1)}));const be=(e,t,n)=>{t.forEach((t=>e.addEventListener(t,(async e=>{await n(e)}))))};"pornhub"===d?window.location.pathname.includes("view_video.php")?be(document.querySelector(".original.mainPlayerDiv > video-element > div"),["mousemove","mouseout"],i):window.location.pathname.includes("embed/")&&be(document.querySelector("#player"),["mousemove","mouseout"],i):be("twitter"===d?document.querySelector('div[data-testid="videoPlayer"'):u,["mousemove","mouseout"],i),document.querySelector(".translationBlock").addEventListener("mousemove",(t=>s(t,e,o))),document.querySelector(".translationMenuContent").addEventListener("mousemove",(t=>s(t,e,o))),document.addEventListener("touchstart",(t=>s(t,e,o))),document.addEventListener("touchmove",(t=>s(t,e,o))),document.addEventListener("touchend",(t=>s(t,e,o))),document.querySelectorAll("video").forEach((e=>{e.addEventListener("abort",(async()=>{f.Z.log("lipsync mode is abort"),await we(),_=""}))})),document.querySelector(".translationBtn").addEventListener("click",(async e=>{if(f.Z.log("[click translationBtn] before all functions & methods"),e.stopPropagation(),e.stopImmediatePropagation(),t.src)return f.Z.log("[click translationBtn] audio.src is not empty"),void await J();try{f.Z.log("[click translationBtn] trying execute translation");const e=x(d);if(!e)throw new y("VOTNoVideoIDFound");await de(e)}catch(e){console.error("[VOT]",e),re("error","VOTLocalizedError"===e?.name?e.localizedMessage:e)}})),p.addEventListener("progress",(async e=>{if(e.stopPropagation(),!R||1!==L)return;const t=x(d);if(!t)throw new y("VOTNoVideoIDFound");try{await de(t),R=!1}catch(e){console.error("[VOT]",e),re("error","VOTLocalizedError"===e?.name?e.localizedMessage:e),R=!1}})),document.querySelector(".translationMenu").addEventListener("click",(async e=>{e.stopPropagation(),e.stopImmediatePropagation();const t=document.querySelector(".translationMenuOptions")?.querySelector("#VOTSubtitlesLang");if(!a||!t)return;const o=x(d);if(!o)return console.error(`[VOT] ${w.getDefault("VOTNoVideoIDFound")}`),st=[],lt=null,void await z();lt!==o&&(_.detectedLanguage||(_=await ne(),await W(_.detectedLanguage,_.responseLanguage)),st=await async function(e,t,o){const a="youtube"===e?E():[];let r=!1;const i=await Promise.race([new Promise((async e=>{await O(5e3),r||console.error("[VOT] Failed get yandex subtitles. Reason: timeout"),r=!0,e([])})),new Promise((a=>{!async function(e,t,o){try{f.Z.log("requestVideoSubtitles");const a=(await Promise.resolve().then(n.bind(n,"./src/yandexRequest.js"))).default;f.Z.log("Inited yandexRequest...");const r=Y(e,t);await a("/video-subtitles/get-subtitles",r,{"Vsubs-Signature":await je(r),"Sec-Vsubs-Token":Ee(!1)},o)}catch(e){console.error("[VOT]",e),o(!1)}}(`${T[e]}${t}`,o,((e,t)=>{f.Z.log("[exec callback] Requesting video subtitles"),e||(console.error("[VOT] Failed get yandex subtitles"),r=!0,a([]));const n=G(t);console.log("[VOT] Subtitles response: ",n);let o=n.subtitles??[];o=o.reduce(((e,t)=>(t.language&&!e.find((e=>{if("yandex"===e.source&&e.language===t.language&&!e.translatedFromLanguage)return e}))&&e.push({source:"yandex",language:t.language,url:t.url}),t.translatedLanguage&&e.push({source:"yandex",language:t.translatedLanguage,translatedFromLanguage:t.language,url:t.translatedUrl}),e)),[]),r=!0,a(o)}))}))]),s=[...i,...a].sort(((e,t)=>{if(e.source!==t.source)return"yandex"===e.source?-1:1;if(e.language!==t.language&&(e.language===te||t.language===te))return e.language===te?-1:1;if("yandex"===e.source){if(e.translatedFromLanguage!==t.translatedFromLanguage)return e.translatedFromLanguage&&t.translatedFromLanguage?e.translatedFromLanguage===o?-1:1:e.language===t.language?e.translatedFromLanguage?1:-1:e.translatedFromLanguage?-1:1;if(!e.translatedFromLanguage)return e.language===o?-1:1}return"youtube"===e.source&&e.isAutoGenerated!==t.isAutoGenerated?e.isAutoGenerated?1:-1:0}));return console.log("[VOT] subtitles list",s),s}(d,o,_.detectedLanguage),st?lt=o:await U("disabled"),await z())}))}await async function(){if(f.Z.log("Runned initWebsite function"),we.youtubeRegex.test(window.location.hostname)){if(window.location.pathname.includes("embed")){const e=document.querySelector(".html5-video-container");return void await u(e,"youtube",null)}f.Z.log("[initWebsite] Found a match with youtube hostname");const e=()=>{const e=document.querySelector(ye);if(e)f.Z.log("[exec] translateProccessor youtube on page enter"),u(e,"youtube","yt-translate-stop");else{if(!ytplayer||!ytplayer.config)return void f.Z.log("[exec] ytplayer is null");ytplayer.config.args.jsapicallback=()=>{f.Z.log("[exec] translateProccessor youtube on page enter (ytplayer.config.args.jsapicallback)"),u(e,"youtube","yt-translate-stop")}}};document.addEventListener("spfdone",e),document.addEventListener("yt-navigate-finish",e);const t=()=>{document.body.dispatchEvent(new Event("yt-translate-stop"))};if(document.addEventListener("spfrequest",t),document.addEventListener("yt-navigate-start",t),window.location.hostname.includes("m.youtube.com")){let e=await S("#player");e&&(await O(2300),await u(e,"youtube","yt-translate-stop"),new MutationObserver((async t=>{for(const n of t)"attributes"===n.type&&"src"===n.attributeName&&(e=await S("#player"),await O(2300),await u(e,"youtube","yt-translate-stop"))})).observe(e,{attributes:!0,childList:!0,subtree:!0,attributeOldValue:!0}));const t=()=>{document.body.dispatchEvent(new Event("yt-translate-stop"))};document.addEventListener("spfdone",t),document.addEventListener("yt-navigate-finish",t),document.addEventListener("spfrequest",t),document.addEventListener("yt-navigate-start",t)}}else if(window.location.hostname.includes("twitch.tv")){if(f.Z.log("[initWebsite] Found a match with twitch.tv"),window.location.hostname.includes("m.twitch.tv")&&(window.location.pathname.includes("/videos/")||window.location.pathname.includes("/clip/"))){if(f.Z.log("[initWebsite] Matched Twitch Mobile"),await S(ve)){await O(200);const e=document.querySelector(ve);await u(e,"twitch",null),new MutationObserver((async t=>{for(const n of t)"attributes"===n.type&&"src"===n.attributeName&&n.target===e?.querySelector("video")&&(await O(1e3),await u(e,"twitch",null))})).observe(e,{attributes:!0,childList:!0,subtree:!0,attributeOldValue:!0})}}else if(window.location.hostname.includes("player.twitch.tv")||window.location.hostname.includes("clips.twitch.tv")||window.location.pathname.includes("/videos/")||window.location.pathname.includes("/clip/")){f.Z.log("[initWebsite] Matched Twitch Desktop");const e=await S(be);e&&(await O(200),await u(e,"twitch",null))}f.Z.log("[initWebsite] Exit function in the twitch section")}else{if(window.location.hostname.includes("xvideos.com"))return f.Z.log("[entered] xvideos"),await O(1e3),void await u(document.querySelector(".video-bg-pic"),"xvideos",null);if(window.location.hostname.includes("pornhub.com"))return f.Z.log("[entered] pornhub"),await O(1e3),void await u(document.querySelector(".mgp_videoWrapper"),"pornhub",null);if(J.includes(window.location.hostname))f.Z.log("[entered] invidious"),await u(document.querySelector("#player"),"youtube",null);else if(X.includes(window.location.hostname)){f.Z.log("[entered] piped");const e=await S(Te);if(e){let t,n=x("youtube");await u(e,"youtube","piped"),setInterval((async()=>{t=x("youtube"),n!==t&&(t&&await u(document.querySelector(Te),"youtube","piped"),n=t)}),3e3)}}else if(/^(www.|m.)?vk.(com|ru)$/.test(window.location.hostname)){if(f.Z.log("[entered] vk.com"),await S(Ve)){let e;await u(document.querySelector(Ve),"vk",null);let t=x("vk");setInterval((async()=>{if(e=x("vk"),t!==e){if(e){const e=await S(Ve);e&&await u(e,"vk",null)}t=e}}),3e3)}}else if(window.location.hostname.includes("vimeo.com"))f.Z.log("[entered] vimeo.com"),await S(Oe)&&(await O(1e3),await u(document.querySelector(Oe),"vimeo",null));else if(window.location.hostname.includes("9gag.com"))await O(1e3),await u(document.querySelector(xe),"9gag",null);else if(window.location.hostname.includes("coub.com"))await O(1e3),await u(document.querySelector(".viewer__player"),"coub",null);else if(window.location.hostname.includes("bitchute.com"))await O(1e3),await u(document.querySelector(".plyr__video-wrapper"),"bitchute",null);else if(window.location.hostname.includes("rutube.ru")){const e=window.location.pathname.includes("/play/embed")?"#app > div > div":".video-player > div > div > div:nth-child(2)",t=await S(e);t&&await u(t,"rutube",null)}else if(window.location.hostname.includes("bilibili.com")){if(window.location.pathname.includes("/video/")||window.location.hostname.includes("player.bilibili.com")){const e=await S(ke);e&&await u(e,"bilibili.com",null)}else if(window.location.pathname.includes("/blackboard/webplayer/embed-old.html")){const e=await S("video");e&&await u(e.parentElement,"bilibili.com",null)}}else if(window.location.hostname.includes("twitter.com")){const e=await S(Se);if(e){let t,n=x("twitter");await u(e,"twitter",null),setInterval((async()=>{t=x("twitter"),n!==t&&(t&&await u(document.querySelector(Se),"twitter",null),n=t)}),3e3)}}else if(window.location.hostname.includes("my.mail.ru")){const e=await S(Le);if(e){let t,n=x("mail.ru");await u(e,"mail.ru",null),setInterval((async()=>{t=x("mail.ru"),n!==t&&(t&&await u(document.querySelector(Le),"mail.ru",null),n=t)}),3e3)}}else if(window.location.hostname.includes("coursera.org")){const e=await S(Me);if(e){let t,n=x("coursera");await u(e,"coursera",null),setInterval((async()=>{t=x("coursera"),n!==t&&(t&&await u(document.querySelector(Me),"coursera",null),n=t)}),3e3)}}else if(window.location.hostname.includes("udemy.com")){const e=await S(Fe);if(e){let t,n=x("udemy");await u(e,"udemy",null),setInterval((async()=>{if(t=x("udemy"),n!==t){const e=await S(Fe);t&&e&&await u(e,"udemy",null),n=t}}),3e3)}}else if(window.location.hostname.includes("tiktok.com")){const e=await S(qe);if(e){let t,n=x("tiktok");await u(e.parentElement,"tiktok",null),setInterval((async()=>{if(t=x("tiktok"),n!==t){const e=await S(qe);t&&e&&await u(e.parentElement,"tiktok",null),n=t}}),3e3)}}else if(Q.includes(window.location.hostname)){const e=await S(De);e&&await u(e,"tiktok",null)}}}()}w.update(),window.addEventListener("DOMContentLoaded",(()=>{ut().catch((e=>{console.error("[VOT]",e)}))}))})()})();
=======
(()=>{"use strict";var e,t,n,o,a={"./node_modules/css-loader/dist/cjs.js!./src/styles/main.css":(e,t,n)=>{n.d(t,{Z:()=>s});var o=n("./node_modules/css-loader/dist/runtime/noSourceMaps.js"),a=n.n(o),r=n("./node_modules/css-loader/dist/runtime/api.js"),i=n.n(r)()(a());i.push([e.id,'.translationBlock {\n  padding: 0.45rem !important;\n  width: max-content;\n  position: absolute;\n  background: #2e2f34;\n  border-radius: 0.5rem !important;\n  left: 50%;\n  top: 5rem;\n  transform: translate(-50%);\n  text-align: center;\n  opacity: 0;\n  transition: opacity 1s;\n  -webkit-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n  z-index: 100;\n}\n\n.translationBtn {\n  position: relative;\n  display: inline-block;\n  vertical-align: middle;\n  color: #fff;\n  padding-right: 0.25rem !important;\n  cursor: pointer;\n  font: 600 12px / 14px "Segoe UI", BlinkMacSystemFont, Arial, sans-serif;\n}\n\n.translationBlock:hover {\n  opacity: 1;\n}\n\n.translationMenu {\n  display: inline-block;\n  vertical-align: middle;\n  border-left: 1px solid #424348;\n  max-height: 16px;\n  max-width: 24px;\n  cursor: pointer;\n}\n\n.translationMenuIcon {\n  padding: 0 10px !important;\n  width: 24px;\n}\n\n.translationIAlice {\n  display: inline-block;\n  vertical-align: middle;\n  max-height: 26px;\n  max-width: 50px;\n}\n\n.translationIconAlice {\n  height: 24px !important;\n  width: 24px !important;\n}\n\n.translationITranslate {\n  display: inline-block;\n  vertical-align: middle;\n  max-height: 20px;\n  max-width: 20px;\n}\n\n.translationMenuContent {\n  position: absolute;\n  background: #2e2f34;\n  color: #fff;\n  display: none;\n  border-radius: 1rem !important;\n  left: 50%;\n  top: 10rem;\n  transform: translate(-50%);\n  text-align: left;\n  font: 600 14px / 16px "Segoe UI", BlinkMacSystemFont, Arial, sans-serif !important;\n\n  width: 300px;\n  /* height: 375px; */\n  opacity: 0;\n  z-index: 100;\n  transition: opacity 0.5s ease;\n}\n\n.VOTMenuSlider {\n  -webkit-appearance: none !important;\n  appearance: none !important;\n  width: 268px !important;\n  height: 8px !important;\n  outline: none !important;\n  margin-top: 0.5rem;\n  opacity: 0.7;\n  /* background: #3C3F4D !important; */\n  background: rgb(253, 222, 85, 0.6) !important;\n  border: none !important;\n  border-radius: 2rem !important;\n  -webkit-transition: 0.2s !important;\n  transition: opacity 0.2s ease !important;\n}\n\n.VOTMenuSlider:hover {\n  opacity: 1;\n}\n\n.VOTMenuSlider::-webkit-slider-thumb {\n  -webkit-appearance: none !important;\n  appearance: none !important;\n  width: 10px !important;\n  height: 10px !important;\n  border-radius: 50% !important;\n  border: none !important;\n  background: #fff !important;\n  cursor: pointer !important;\n}\n\n.VOTMenuSlider::-moz-range-thumb {\n  width: 10px !important;\n  height: 10px !important;\n  border-radius: 50% !important;\n  border: none !important;\n  background: #fff !important;\n  cursor: pointer !important;\n}\n\n.VOTMenuSlider::-ms-thumb {\n  width: 10px !important;\n  height: 10px !important;\n  border-radius: 50% !important;\n  border: none !important;\n  background: #fff !important;\n  cursor: pointer !important;\n}\n\n.VOTMenuSlider::-ms-fill-lower {\n  height: 8px !important;\n  border-radius: 2rem !important;\n  background: linear-gradient(\n    90.1deg,\n    rgba(186, 153, 244, 0.85) -5.78%,\n    rgba(236, 138, 202, 0.7) 56.46%,\n    rgba(239, 168, 117, 0.6) 108.93%\n  ) !important;\n}\n\n.VOTMenuSlider::-moz-range-progress {\n  height: 8px !important;\n  border-radius: 2rem !important;\n  background: linear-gradient(\n    90.1deg,\n    rgba(186, 153, 244, 0.85) -5.78%,\n    rgba(236, 138, 202, 0.7) 56.46%,\n    rgba(239, 168, 117, 0.6) 108.93%\n  ) !important;\n}\n\n.translationHeader {\n  padding-bottom: 0.5rem !important;\n}\n\n.translationMainHeader {\n  margin: 16px !important;\n  color: #fff;\n  font: 900 14px / 16px "Segoe UI", BlinkMacSystemFont, Arial, sans-serif !important;\n}\n\n.translationMenuOptions {\n  display: flex;\n  flex-flow: column wrap;\n}\n\n.translationMenuContainer {\n  /* width: 100%; */\n  padding-left: 16px !important;\n  padding-top: 5px !important;\n  display: inline-block !important;\n}\n\n.translationMenuContainer > input {\n  appearance: auto !important;\n  vertical-align: text-bottom;\n}\n\n.translationMenuText {\n  color: #fff;\n  display: inline-flex;\n  width: 80%;\n}\n\n.translationVolumeBox,\n.translationVideoVolumeBox {\n  padding-top: 0.5rem !important;\n}\n\n.translationDropDB,\n.translationUdemyData {\n  border: none !important;\n  border-radius: 4px !important;\n  background: #5426ff !important;\n  color: #fff !important;\n  padding: 6px 16px !important;\n  margin-left: auto !important;\n  cursor: pointer !important;\n}\n\n.translationUdemyData {\n  margin: 16px !important;\n}\n\n.translationDownload {\n  background: #5426ff !important;\n  color: #fff !important;\n  padding: 2px 10px !important;\n  border-radius: 4px !important;\n  cursor: pointer;\n  display: none;\n}\n\n.translationMenuFunctional {\n  display: flex;\n  margin: 16px !important;\n}\n\n.VOTMenuSelect {\n  width: 110px;\n  border-radius: 5px !important;\n  border: 1px solid #dadce0 !important;\n  box-shadow: 0 1px 3px -2px #9098a9;\n  box-sizing: border-box !important;\n  color: #2e2f34 !important;\n  background: #fff !important;\n  padding: 5px !important;\n}\n\n.VOTMenuSelect:focus {\n  outline: none;\n}\n\n.VOTMenuSelect:focus {\n  outline: none;\n  border-color: #0077ff;\n  box-shadow: 0 0 0 2px rgba(#0077ff, 0.2);\n}\n\n#VOTSelectLanguages {\n  display: flex !important;\n  margin-left: 5px;\n}\n\n#VOTSelectLanguages svg {\n  margin: 0 5px;\n}\n\n#VOTSubtitlesLangContainer {\n  display: flex !important;\n  justify-content: space-between;\n  align-items: center;\n  margin-left: 5px;\n}\n\n#VOTSubtitlesLang {\n  margin-right: 25px;\n}\n\n.VOTSubtitlesWidget {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  position: absolute;\n  width: 50%;\n  max-height: 100%;\n  min-height: 20%;\n  z-index: 100;\n  left: 25%;\n  top: 75%;\n  pointer-events: none;\n}\n\n.VOTSubtitlesWidget > div {\n  position: relative;\n  max-width: 100%;\n  max-height: 100%;\n  width: max-content;\n  background: #2e2f34cc;\n  border-radius: 1rem;\n  pointer-events: all;\n  padding: 1rem;\n  font-size: 2rem;\n  box-sizing: border-box;\n  -webkit-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n}\n\n.VOTSubtitlesWidget .passed {\n  color: #9e84ff;\n}\n',""]);const s=i},"./node_modules/css-loader/dist/runtime/api.js":e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",o=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),o&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),o&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,o,a,r){"string"==typeof e&&(e=[[null,e,void 0]]);var i={};if(o)for(var s=0;s<this.length;s++){var l=this[s][0];null!=l&&(i[l]=!0)}for(var c=0;c<e.length;c++){var u=[].concat(e[c]);o&&i[u[0]]||(void 0!==r&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=r),n&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=n):u[2]=n),a&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=a):u[4]="".concat(a)),t.push(u))}},t}},"./node_modules/css-loader/dist/runtime/noSourceMaps.js":e=>{e.exports=function(e){return e[1]}},"./src/styles/main.css":(e,t,n)=>{var o=n("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),a=n.n(o),r=n("./node_modules/style-loader/dist/runtime/styleDomAPI.js"),i=n.n(r),s=n("./node_modules/style-loader/dist/runtime/insertBySelector.js"),l=n.n(s),c=n("./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js"),u=n.n(c),d=n("./node_modules/style-loader/dist/runtime/insertStyleElement.js"),g=n.n(d),p=n("./node_modules/style-loader/dist/runtime/styleTagTransform.js"),m=n.n(p),h=n("./node_modules/css-loader/dist/cjs.js!./src/styles/main.css"),f={};f.styleTagTransform=m(),f.setAttributes=u(),f.insert=l().bind(null,"head"),f.domAPI=i(),f.insertStyleElement=g(),a()(h.Z,f),h.Z&&h.Z.locals&&h.Z.locals},"./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js":e=>{var t=[];function n(e){for(var n=-1,o=0;o<t.length;o++)if(t[o].identifier===e){n=o;break}return n}function o(e,o){for(var r={},i=[],s=0;s<e.length;s++){var l=e[s],c=o.base?l[0]+o.base:l[0],u=r[c]||0,d="".concat(c," ").concat(u);r[c]=u+1;var g=n(d),p={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==g)t[g].references++,t[g].updater(p);else{var m=a(p,o);o.byIndex=s,t.splice(s,0,{identifier:d,updater:m,references:1})}i.push(d)}return i}function a(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,a){var r=o(e=e||[],a=a||{});return function(e){e=e||[];for(var i=0;i<r.length;i++){var s=n(r[i]);t[s].references--}for(var l=o(e,a),c=0;c<r.length;c++){var u=n(r[c]);0===t[u].references&&(t[u].updater(),t.splice(u,1))}r=l}}},"./node_modules/style-loader/dist/runtime/insertBySelector.js":e=>{var t={};e.exports=function(e,n){var o=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(n)}},"./node_modules/style-loader/dist/runtime/insertStyleElement.js":e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},"./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js":(e,t,n)=>{e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},"./node_modules/style-loader/dist/runtime/styleDomAPI.js":e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var o="";n.supports&&(o+="@supports (".concat(n.supports,") {")),n.media&&(o+="@media ".concat(n.media," {"));var a=void 0!==n.layer;a&&(o+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),o+=n.css,a&&(o+="}"),n.media&&(o+="}"),n.supports&&(o+="}");var r=n.sourceMap;r&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),t.styleTagTransform(o,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},"./node_modules/style-loader/dist/runtime/styleTagTransform.js":e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},"./src/config/alternativeUrls.js":(e,t,n)=>{n.d(t,{U:()=>a,a:()=>o});const o=["invidious.snopyta.org","yewtu.be","invidious.kavin.rocks","vid.puffyan.us","invidious.namazso.eu","inv.riverside.rocks","yt.artemislena.eu","invidious.flokinet.to","invidious.esmailelbob.xyz","y.com.sb","invidious.nerdvpn.de","inv.vern.cc","invidious.slipfox.xyz","invidio.xamh.de","invidious.dhusch.de"],a=["piped.video","piped.tokhmi.xyz","piped.moomoo.me","piped.syncpundit.io","piped.mha.fi","watch.whatever.social","piped.garudalinux.org","efy.piped.pages.dev","watch.leptons.xyz","piped.lunar.icu","yt.dc09.ru","piped.mint.lgbt","il.ax","piped.privacy.com.de","piped.esmailelbob.xyz","piped.projectsegfau.lt","piped.in.projectsegfau.lt","piped.us.projectsegfau.lt","piped.privacydev.net","piped.palveluntarjoaja.eu","piped.smnz.de","piped.adminforge.de","piped.qdi.fi","piped.hostux.net","piped.chauvet.pro","piped.jotoma.de","piped.pfcd.me","piped.frontendfriendly.xyz"]},"./src/config/config.js":(e,t,n)=>{n.d(t,{I1:()=>a,IM:()=>i,Rr:()=>r,iF:()=>o});const o="api.browser.yandex.ru",a="xtGCyGdTY2Jy6OMEKdTuXev3Twhkamgm",r="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 YaBrowser/23.7.1.1140 Yowser/2.5 Safari/537.36",i=.15},"./src/config/constants.js":(e,t,n)=>{n.d(t,{Az:()=>i,g$:()=>r,tW:()=>o,zL:()=>a});const o=["ru","en","zh","ko","ar","fr","it","es","de","ja"],a=["bn","pt","cs","hi","mr","te","tr","ms","vi","ta","jv","ur","fa","gu","id","uk","kk","da","fi","uz","pl","sv"],r={youtube:"https://youtu.be/",twitch:"https://twitch.tv/",vimeo:"https://vimeo.com/","9gag":"https://9gag.com/gag/",vk:"https://vk.com/video?z=",xvideos:"https://www.xvideos.com/",pornhub:"https://rt.pornhub.com/view_video.php?viewkey=",udemy:"https://www.udemy.com/",twitter:"https://twitter.com/i/status/",facebook:"https://www.facebook.com/",rutube:"https://rutube.ru/video/","bilibili.com":"https://www.bilibili.com/video/","mail.ru":"https://my.mail.ru/",coub:"https://coub.com/view/",bitchute:"https://www.bitchute.com/video/",coursera:"https://www.coursera.org/"},i=["Violentmonkey","FireMonkey","Greasemonkey","AdGuard","OrangeMonkey"]},"./src/config/regexes.js":(e,t,n)=>{n.d(t,{Z:()=>o});const o={youtubeRegex:/^(www.|m.)?youtube(-nocookie)?.com$/}},"./src/config/selectors.js":(e,t,n)=>{n.d(t,{Z:()=>o});const o={youtubeSelector:".html5-video-container",twitchSelector:".video-ref",twitchMobileSelector:"main > div > section > div > div > div",pipedSelector:".shaka-video-container",vkSelector:".videoplayer_media",twitterSelector:'div[data-testid="videoComponent"] > div:nth-child(1) > div',vimeoSelector:".player",gagSelector:".video-post",bilibilicomSelector:".bpx-player-video-wrap",mailSelector:"#b-video-wrapper"}},"./src/getSignature.js":(e,t,n)=>{n.d(t,{o:()=>a});var o=n("./src/config/config.js");async function a(e){const t=new TextEncoder("utf-8"),n=await window.crypto.subtle.importKey("raw",t.encode(o.I1),{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign","verify"]),a=await window.crypto.subtle.sign("HMAC",n,e);return Array.from(new Uint8Array(a),(e=>e.toString(16).padStart(2,"0"))).join("")}},"./src/getUUID.js":(e,t,n)=>{function o(e){const t=([1e7]+1e3+4e3+8e3+1e11).replace(/[018]/g,(e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)));return e?t:t.toUpperCase()}n.d(t,{F:()=>o})},"./src/index.js":(e,t,n)=>{n.a(e,(async(e,t)=>{try{n("./src/styles/main.css");var o=n("./src/utils/VOTLocalizedError.js"),a=n("./src/utils/youtubeUtils.js"),r=n("./src/yandexProtobuf.js"),i=n("./src/utils/utils.js"),s=n("./src/config/config.js"),l=n("./src/config/alternativeUrls.js"),c=n("./src/config/constants.js"),u=n("./src/localization/localizationProvider.js"),d=n("./src/indexedDB.js"),g=n("./src/menu.js"),p=n("./src/utils/volume.js"),m=n("./src/config/regexes.js"),h=n("./src/config/selectors.js"),f=n("./src/utils/debug.js"),y=n("./src/rvt.js"),w=n("./src/subtitles.js"),b=n("./src/utils/courseraUtils.js"),v=n("./src/utils/udemyUtils.js");const T=[...l.a,...l.U];let V="en",S=g.KQ,O="",x=[],k=null;async function L(){if(f.Z.log("Loading extension..."),f.Z.log(`Selected menu language: ${g.KQ}`),GM_info?.scriptHandler&&c.Az.includes(GM_info.scriptHandler))return console.error(`[VOT] ${u.V.getDefault("unSupportedExtensionError").format(GM_info.scriptHandler)}`),alert(`[VOT] ${u.V.get("unSupportedExtensionError").format(GM_info.scriptHandler)}`);let e;f.Z.log("Extension compatibility passed...");const t=new Audio;let n=.9,L=!1;function M(e){L||(document.querySelector(".translationBlock").style.opacity=e)}function j(){clearTimeout(e),M(1),e=setTimeout((()=>{M(0)}),2e3)}function q(e,t,n){clearTimeout(t),M(n),e.stopPropagation()}async function F(l,m,h){let F,D,P,E,Z,C,A,$,_,R,N,I,B,U,z,H;f.Z.log("[translateProccessor] execute on element: ",l);let W,J=!0,K="";f.Z.log("videoContainer",l),F="vimeo"===m?l.querySelector(".vp-video-wrapper > .vp-video > .vp-telecine > video"):l.querySelector("video"),f.Z.log("video",F);const Y="pornhub"===m&&window.location.pathname.includes("view_video.php")?document.querySelector(".original.mainPlayerDiv"):"pornhub"===m&&window.location.pathname.includes("embed/")?document.querySelector("body"):window.location.hostname.includes("m.youtube.com")?document.querySelector("#player-control-container"):l;(0,g.Ot)(Y),function(e){if(e.querySelector(".translationMenuContent"))return;const t=(0,g.NX)();e.appendChild(t),document.querySelector(".translationMenu")?.addEventListener("click",(e=>{e.stopPropagation();const t=document.querySelector(".translationMenuContent");t.style.display=L?"none":"block",t.style.opacity=n,L=!L})),document.querySelector(".translationDropDB").addEventListener("click",(e=>{e.stopPropagation(),(0,d.Lj)(),location.reload()})),f.Z.log("Added translation menu to ",e)}(Y),window.location.hostname.includes("youtube.com")&&!window.location.hostname.includes("m.youtube.com")?(0,w.e7)(Y.parentElement):(0,w.e7)(Y),await X("disabled");try{W=await(0,d.zK)()}catch(e){console.error("[VOT] Failed to initialize database settings. All changes made will not be saved",e)}const G=document.querySelector(".translationMenuOptions");if(G&&!G.querySelector("#VOTTranslateFromLang")){const e=[{label:u.V.get("videoLanguage"),value:"default",disabled:!0},...(0,g.Ef)(c.tW,K.detectedLanguage)],t=[{label:u.V.get("translationLanguage"),value:"default",disabled:!0},...(0,g.Ef)(c.tW,K.responseLanguage),{label:"─────────",value:"separator",disabled:!0},...(0,g.Ef)(c.zL,K.responseLanguage)],n=(0,g.Mr)("VOTTranslateFromLang",e),o=(0,g.Mr)("VOTTranslateToLang",t).firstElementChild;n.id="VOTSelectLanguages",n.innerHTML+='\n        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">\n          <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12h16m0 0l-6 6m6-6l-6-6"/>\n        </svg>\n      ',n.appendChild(o),G.appendChild(n),G.querySelector("#VOTTranslateFromLang").addEventListener("change",(async e=>{f.Z.log("[onchange] select from language",e.target.value),K=await re(),await ee(e.target.value,K.responseLanguage)})),G.querySelector("#VOTTranslateToLang").addEventListener("change",(async e=>{f.Z.log("[onchange] select to language",e.target.value),W&&(S=e.target.value,await(0,d.l6)({responseLanguage:e.target.value}),f.Z.log("Response Language value changed. New value: ",e.target.value)),K=await re(),await ee(K.detectedLanguage,e.target.value)}))}async function X(e){f.Z.log("[onchange] subtitles",e);const t=document.querySelector(".translationMenuOptions")?.querySelector("#VOTSubtitlesLang");if(t&&(t.value=e),!F)return console.error("[VOT] video not found"),void(t&&(t.value="disabled"));"disabled"===e?(0,w.Bv)(F,null):(0,w.Bv)(F,await(0,w.Hl)(x.at(parseInt(e))))}async function Q(){const e=document.querySelector(".translationMenuOptions")?.querySelector("#VOTSubtitlesLang");if(!e)return void console.error("[VOT] #VOTSubtitlesLang not found");const t=e.value;e.innerHTML="";const n=document.createElement("option");n.value="disabled",n.innerHTML=u.V.get("VOTSubtitlesDisabled"),e.append(n);for(let t=0;t<x.length;t++){const n=x[t],o=document.createElement("option");o.value=t,o.innerHTML=(u.V.get("langs")[n.language]??n.language.toUpperCase())+(n.translatedFromLanguage?` ${u.V.get("VOTTranslatedFrom")} ${u.V.get("langs")[n.translatedFromLanguage]??n.translatedFromLanguage.toUpperCase()}`:"")+("yandex"!==n.source?` ${n.source}`:"")+(n.isAutoGenerated?` (${u.V.get("VOTAutogenerated")})`:""),e.append(o)}await X(t)}if(G&&!G.querySelector("#VOTSubtitlesLang")){const e=[{label:u.V.get("VOTSubtitlesDisabled"),value:"disabled",disabled:!1}],t=(0,g.Mr)("VOTSubtitlesLang",e);t.id="VOTSubtitlesLangContainer";const n=document.createElement("span");n.textContent=u.V.get("VOTSubtitles"),t.prepend(n),G.appendChild(t),G.querySelector("#VOTSubtitlesLang").addEventListener("change",(async e=>{await X(e.target.value)}))}if(W){const e=await(0,d.CZ)();if(e){if(C=e.subtitlesMaxLength,A=e.highlightWords,$=e.autoTranslate,_=e.defaultVolume,R=e.showVideoSlider,N=e.autoSetVolumeYandexStyle,I=e.dontTranslateYourLang,z=e.responseLanguage,H=e.audioProxy,B=e.syncVolume,U=e.udemyData,f.Z.log("[db] data from db: ",e),void 0!==C&&(0,w.Lg)(C),void 0!==A&&(0,w.b6)(A),void 0!==z&&(K=await re(),ee(K.detectedLanguage,z),S=z),void 0!==C&&G&&!G.querySelector("#VOTSubtitlesMaxLengthSlider")){const e=(0,g.iT)("VOTSubtitlesMaxLengthSlider",C,`${u.V.get("VOTSubtitlesMaxLength")}: <b id="VOTSubtitlesMaxLengthValue">${C}</b>`,50,300);e.querySelector("#VOTSubtitlesMaxLengthSlider").oninput=async t=>{const n=Number(t.target.value);await(0,d.l6)({subtitlesMaxLength:n}),C=n,e.querySelector("#VOTSubtitlesMaxLengthValue").innerText=`${n}`,(0,w.Lg)(n)},G.appendChild(e)}if(void 0!==A&&G&&!G.querySelector("#VOTHighlightWords")){const e=(0,g.H0)("VOTHighlightWords",A,u.V.get("VOTHighlightWords"));e.querySelector("#VOTHighlightWords").onclick=async e=>{e.stopPropagation();const t=Number(e.target.checked);await(0,d.l6)({highlightWords:t}),A=t,f.Z.log("highlightWords value changed. New value: ",A),(0,w.b6)(t)},G.appendChild(e)}if(void 0!==$&&G&&!G.querySelector("#VOTAutoTranslate")){const e=(0,g.H0)("VOTAutoTranslate",$,u.V.get("VOTAutoTranslate")+("vk"===m||window.location.hostname.includes("m.twitch.tv")?` <strong>(${u.V.get("recommended")})</strong>`:""));e.querySelector("#VOTAutoTranslate").onclick=async e=>{e.stopPropagation();const t=Number(e.target.checked);await(0,d.l6)({autoTranslate:t}),$=t,f.Z.log("autoTranslate value changed. New value: ",$)},G.appendChild(e)}if(window.location.hostname.includes("youtube.com")&&void 0!==I&&G&&!G.querySelector("#VOTDontTranslateYourLang")){const e=(0,g.H0)("VOTDontTranslateYourLang",I,u.V.get("VOTDontTranslateYourLang"));e.querySelector("#VOTDontTranslateYourLang").onclick=async e=>{e.stopPropagation();const t=Number(e.target.checked);await(0,d.l6)({dontTranslateYourLang:t}),I=t,f.Z.log("dontTranslateYourLang value changed. New value: ",I)},G.appendChild(e)}if(void 0!==N&&G&&!G.querySelector("#VOTAutoSetVolume")){const e=(0,g.H0)("VOTAutoSetVolume",N,u.V.get("VOTAutoSetVolume")+(100*s.IM+"%"));e.querySelector("#VOTAutoSetVolume").onclick=async e=>{e.stopPropagation();const t=Number(e.target.checked);await(0,d.l6)({autoSetVolumeYandexStyle:t}),N=t,f.Z.log("autoSetVolumeYandexStyle value changed. New value: ",N)},G.appendChild(e)}if(void 0!==R&&G&&!G.querySelector("#VOTShowVideoSlider")){const e=(0,g.H0)("VOTShowVideoSlider",R,u.V.get("VOTShowVideoSlider"));e.querySelector("#VOTShowVideoSlider").onclick=async e=>{e.stopPropagation();const t=Number(e.target.checked);await(0,d.l6)({showVideoSlider:t}),R=t,f.Z.log("showVideoSlider value changed. New value: ",R),1===R&&"success"===document.querySelector(".translationBtn").dataset.state?se():document.querySelector("#VOTVideoSlider")?.parentElement.remove()},G.appendChild(e)}if(window.location.hostname.includes("youtube.com")&&!window.location.hostname.includes("m.youtube.com")&&void 0!==B&&G&&!G.querySelector("#VOTSyncVolume")){const e=(0,g.H0)("VOTSyncVolume",B,u.V.get("VOTSyncVolume"));e.querySelector("#VOTSyncVolume").onclick=async e=>{e.stopPropagation();const t=Number(e.target.checked);await(0,d.l6)({syncVolume:t}),B=t,f.Z.log("syncVolume value changed. New value: ",B)},G.appendChild(e)}if(window.location.hostname.includes("udemy.com")&&void 0!==U&&G&&!G.querySelector("#VOTUdemyData")){const e=document.createElement("button");e.classList.add("translationUdemyData"),e.innerText=u.V.get("VOTUdemyData"),e.onclick=async e=>{e.stopPropagation();const t={accessToken:prompt(u.V.get("enterUdemyAccessToken")),expires:(new Date).getTime()};await(0,d.l6)({udemyData:t}),U=t,f.Z.log("udemyData value changed. New value: ",U),window.location.reload()},G.appendChild(e)}}}if((0,g.uJ)("none",u.V.get("translateVideo")),window.location.hostname.includes("youtube.com")&&!window.location.hostname.includes("m.youtube.com")){const e=new MutationObserver((async function(e){e.forEach((async function(e){"attributes"===e.type&&"aria-valuenow"===e.attributeName&&document.querySelector("#VOTVideoSlider")&&ne()}))})),t=document.querySelector(".ytp-volume-panel");t&&e.observe(t,{attributes:!0,childList:!1,subtree:!0,attributeOldValue:!0})}async function ee(e,t){document.querySelector("#VOTSelectLanguages")&&(document.querySelector("#VOTTranslateFromLang").value=e,document.querySelector("#VOTTranslateToLang").value=t,console.log(`[VOT] Set translation from ${e} to ${t}`),K.detectedLanguage=e,K.responseLanguage=t)}async function te(){t.pause(),F.removeEventListener(".translate",te,!1),await(async()=>{t.src="",t.removeAttribute("src")})(),document.querySelector("#VOTVideoSlider")?.parentElement.remove(),document.querySelector("#VOTTranslationSlider")?.parentElement.remove();const e=document.querySelector(".translationDownload");e&&(e.href="",e.style.display="none"),(0,g.uJ)("none",u.V.get("translateVideo")),P&&(f.Z.log(`Volume on start: ${P}`),window.location.hostname.includes("youtube.com")?document.querySelector(".html5-video-player").setVolume(100*P):F.volume=P)}async function ne(){const e=Math.round(100*oe()),t=document.querySelector("#VOTVideoSlider");if(!t)return;t.value=e;const n=document.querySelector("#VOTOriginalVolume");n&&(n.innerText=`${e}%`),1===B&&(E=Number(e))}function oe(){let e=F?.volume;return window.location.hostname.includes("youtube.com")&&(e=a.K.getVideoVolume()||e),e}function ae(e){if(window.location.hostname.includes("youtube.com"))return a.K.setVideoVolume(e);F.volume=e}async function re(){const e={translationHelp:null};if(e.duration=F?.duration||343,e.videoId=(0,i.gJ)(m),e.detectedLanguage=V,e.responseLanguage=S,window.location.hostname.includes("youtube.com"))O=await a.K.getVideoData(),""!==O.author&&(e.detectedLanguage=O.detectedLanguage,e.responseLanguage=S);else if(window.location.hostname.includes("rutube")||window.location.hostname.includes("my.mail.ru"))e.detectedLanguage="ru",e.responseLanguage="en";else if(window.location.hostname.includes("bilibili.com"))e.detectedLanguage="zh";else if(window.location.hostname.includes("coursera.org")){const t=await b.O.getVideoData(S);e.duration=t.duration||e.duration,e.detectedLanguage=t.detectedLanguage,e.translationHelp=t.translationHelp}else if(window.location.hostname.includes("udemy.com")){const t=await v.O.getVideoData(U,S);e.duration=t.duration||e.duration,e.detectedLanguage=t.detectedLanguage,e.translationHelp=t.translationHelp}return e}const ie=async(e=!1)=>{if(f.Z.log("lipsync video",F),F)if(t.currentTime=F.currentTime,t.playbackRate=F.playbackRate,e)if("play"!==e)"pause"===e&&(f.Z.log("lipsync mode is pause"),t.pause()),"stop"===e&&(f.Z.log("lipsync mode is stop"),t.pause()),"waiting"===e&&(f.Z.log("lipsync mode is waiting"),t.pause()),"playing"===e&&(f.Z.log("lipsync mode is playing"),t.play());else{f.Z.log("lipsync mode is play");const e=t.play();void 0!==e&&e.catch((e=>{if(console.error("[VOT]",e),"NotAllowedError"===e.name)throw(0,g.uJ)("error",u.V.get("grantPermissionToAutoPlay")),new o.C("grantPermissionToAutoPlay");if("NotSupportedError"===e.name)throw(0,g.uJ)("error",T.includes(window.location.hostname)?u.V.get("neededAdditionalExtension"):u.V.get("audioFormatNotSupported")),T.includes(window.location.hostname)?new o.C("neededAdditionalExtension"):new o.C("audioFormatNotSupported")}))}else f.Z.log("lipsync mode is not set")};function se(){if(1!==R||document.querySelector("#VOTVideoSlider")||"success"!==document.querySelector(".translationBtn").dataset.state)return;const e=100*oe();E=e;const n=(0,g.iT)("VOTVideoSlider",e,`${u.V.get("VOTVolume")}: <b class = "volumePercent" id="VOTOriginalVolume">${e}%</b>`);n.querySelector("#VOTVideoSlider").oninput=async e=>{const{value:o}=e.target;if(ae(o/100),n.querySelector("#VOTOriginalVolume").innerText=`${o}%`,1!==B)return;const a=document.querySelector("#VOTTranslationSlider");if(!a)return;const r=Number(a.value),i=(0,p.C)(t,o,r,E);a.value=i;const s=document.querySelector("#VOTTranslationVolume");s&&(s.innerText=`${i}%`),Z=i,E=o},document.querySelector(".translationMenuOptions").appendChild(n)}const le=async e=>{K.detectedLanguage||(K=await re(),await ee(K.detectedLanguage,K.responseLanguage)),f.Z.log("Run videoValidator"),await async function(){if(window.location.hostname.includes("youtube.com")){if(f.Z.log("VideoValidator videoData: ",K),1===I&&K.detectedLanguage===g.KQ&&K.responseLanguage===g.KQ)throw new o.C("VOTDisableFromYourLang");if(O.isPremiere)throw new o.C("VOTPremiere");if(O.isLive)throw new o.C("VOTLiveNotSupported");if(K.duration>14400)throw new o.C("VOTVideoIsTooLong")}return!0}(),f.Z.log("Run translateFunc"),await de(e,K.detectedLanguage,K.responseLanguage,K.translationHelp)};async function ce(e){f.Z.log(`video ${e.type}`),await ie(e.type)}async function ue(){await te(),await ne()}async function de(e,n,a,w){console.log("[VOT] Video Data: ",K);const b=`${c.g$[m]}${e}`;if(["udemy","coursera"].includes(m)&&!w)throw new o.C("VOTTranslationHelpNull");!function(e,t,n,o,a,s){f.Z.log(`Translate video (url: ${e}, duration: ${t}, requestLang: ${n}, responseLang: ${o})`),f.Z.log("translationHelp:",a),(0,y.Z)(e,t,n,o,a,((e,t)=>{if(f.Z.log("[exec callback] Requesting video translation"),!e)return void s(!1,u.V.get("requestTranslationFailed"));const n=r.X.decodeTranslationResponse(t);switch(console.log("[VOT] Translation response: ",n),n.status){case 0:s(!1,n.message);break;case 1:s(!!n.url,n.url||u.V.get("audioNotReceived"));break;case 2:s(!1,n.remainingTime?(0,i.PG)(n.remainingTime):u.V.get("translationTakeFewMinutes"));break;case 3:s(!1,u.V.get("videoBeingTranslated"))}}))}(b,K.duration,n,a,w,(async(o,r)=>{if(f.Z.log("[exec callback] translateVideo"),(0,i.gJ)(m)!==e)return;if(!o)throw"VOTLocalizedError"===r?.name?(0,g.uJ)("error",r.localizedMessage):(0,g.uJ)("error",r),r.includes(u.V.get("translationTake"))&&(clearTimeout(D),D=setTimeout((()=>de(e,n,a,w)),6e4)),r;switch(t.src=r,P=oe(),"number"==typeof _&&(t.volume=_/100),"number"==typeof N&&N&&ae(s.IM),m){case"twitter":document.querySelector('div[data-testid="app-bar-back"][role="button"]').addEventListener("click",ue);break;case"invidious":case"piped":break;default:null!==h&&document.body.addEventListener(h,ue)}const c=["twitch","vimeo","facebook","rutube","twitter","bilibili.com","mail.ru"];for(let e=0;e<c.length;e++)if(m===c[e]){new MutationObserver((async e=>{e.forEach((async e=>{"attributes"===e.type&&"src"===e.attributeName&&e.target===F&&""!==e.target.src&&(ue(),J=!0)}))})).observe(l,{attributes:!0,childList:!1,subtree:!0,attributeOldValue:!0});break}F&&!F.paused&&ie("play");const y=document.querySelectorAll("video"),b=["playing","ratechange","play","waiting","pause"];y.forEach((e=>b.forEach((t=>e.addEventListener(t,ce))))),(0,g.uJ)("success",u.V.get("disableTranslate")),se(),await async function(){if(document.querySelector("#VOTTranslationSlider")||"success"!==document.querySelector(".translationBtn").dataset.state)return;const e="number"==typeof _?_:100;E=e;const n=(0,g.iT)("VOTTranslationSlider",e,`${u.V.get("VOTVolumeTranslation")}: <b class = "volumePercent" id="VOTTranslationVolume">${e}%</b>`);n.querySelector("#VOTTranslationSlider").oninput=async({target:{value:e}})=>{t.volume=e/100,document.querySelector("#VOTTranslationVolume").innerText=`${e}%`,await(0,d.l6)({defaultVolume:Number(e)}),_=Number(e),1===B&&function(e){const t=document.querySelector("#VOTVideoSlider");if(!t)return;const n=Number(t.value),o=(0,p.C)(F,e,n,Z);t.value=o;const a=document.querySelector("#VOTOriginalVolume");a&&(a.innerText=`${o}%`),E=o,Z=e}(e)},document.querySelector(".translationMenuOptions").appendChild(n)}();const v=document.querySelector("#VOTVideoSlider");v&&(v.value=100*s.IM);const T=document.querySelector("#VOTOriginalVolume");T&&(T.innerText=100*s.IM+"%");const V=document.querySelector(".translationDownload");V.href=r,V.style.display="initial"}))}document.addEventListener("click",(async e=>{const t=document.querySelector(".translationBlock"),n=document.querySelector(".translationMenuContent"),o=!(!t&&e.target!==t)&&t.contains(e.target),a=!(!n&&e.target!==n)&&n.contains(e.target),r=!(!l&&e.target!==l)&&l.contains(e.target);f.Z.log(`[document click] ${o} ${a} ${r}`),o||a||(r||M(0),n.style.display="none",L=!1)}));const ge=(e,t,n)=>{t.forEach((t=>e.addEventListener(t,(async e=>{await n(e)}))))};"pornhub"===m?window.location.pathname.includes("view_video.php")?ge(document.querySelector(".original.mainPlayerDiv > video-element > div"),["mousemove","mouseout"],j):window.location.pathname.includes("embed/")&&ge(document.querySelector("#player"),["mousemove","mouseout"],j):ge("twitter"===m?document.querySelector('div[data-testid="videoPlayer"'):l,["mousemove","mouseout"],j),document.querySelector(".translationBlock").addEventListener("mousemove",(t=>q(t,e,n))),document.querySelector(".translationMenuContent").addEventListener("mousemove",(t=>q(t,e,n))),document.addEventListener("touchstart",(t=>q(t,e,n))),document.addEventListener("touchmove",(t=>q(t,e,n))),document.addEventListener("touchend",(t=>q(t,e,n))),document.querySelectorAll("video").forEach((e=>{e.addEventListener("abort",(async()=>{f.Z.log("lipsync mode is abort"),await ue(),K=""}))})),document.querySelector(".translationBtn").addEventListener("click",(async e=>{if(f.Z.log("[click translationBtn] before all functions & methods"),e.stopPropagation(),e.stopImmediatePropagation(),t.src)return f.Z.log("[click translationBtn] audio.src is not empty"),void await te();try{f.Z.log("[click translationBtn] trying execute translation");const e=(0,i.gJ)(m);if(!e)throw new o.C("VOTNoVideoIDFound");await le(e)}catch(e){console.error("[VOT]",e),"VOTLocalizedError"===e?.name?(0,g.uJ)("error",e.localizedMessage):(0,g.uJ)("error",e)}})),F.addEventListener("progress",(async e=>{if(e.stopPropagation(),!J||1!==$)return;const t=(0,i.gJ)(m);if(!t)throw new o.C("VOTNoVideoIDFound");try{await le(t),J=!1}catch(e){console.error("[VOT]",e),"VOTLocalizedError"===e?.name?(0,g.uJ)("error",e.localizedMessage):(0,g.uJ)("error",e),J=!1}})),document.querySelector(".translationMenu").addEventListener("click",(async e=>{e.stopPropagation(),e.stopImmediatePropagation();const t=document.querySelector(".translationMenuOptions")?.querySelector("#VOTSubtitlesLang");if(!L||!t)return;const n=(0,i.gJ)(m);if(!n)return console.error(`[VOT] ${u.V.getDefault("VOTNoVideoIDFound")}`),x=[],k=null,void await Q();k!==n&&(K.detectedLanguage||(K=await re(),await ee(K.detectedLanguage,K.responseLanguage)),x=await(0,w.MF)(m,n,K.detectedLanguage),x?k=n:await X("disabled"),await Q())}))}await async function(){if(f.Z.log("Runned initWebsite function"),m.Z.youtubeRegex.test(window.location.hostname)){if(window.location.pathname.includes("embed")){const e=document.querySelector(".html5-video-container");return void await F(e,"youtube",null)}f.Z.log("[initWebsite] Found a match with youtube hostname");const e=()=>{const e=document.querySelector(h.Z.youtubeSelector);if(e)f.Z.log("[exec] translateProccessor youtube on page enter"),F(e,"youtube","yt-translate-stop");else{if(!ytplayer||!ytplayer.config)return void f.Z.log("[exec] ytplayer is null");ytplayer.config.args.jsapicallback=()=>{f.Z.log("[exec] translateProccessor youtube on page enter (ytplayer.config.args.jsapicallback)"),F(e,"youtube","yt-translate-stop")}}};document.addEventListener("spfdone",e),document.addEventListener("yt-navigate-finish",e);const t=()=>{document.body.dispatchEvent(new Event("yt-translate-stop"))};if(document.addEventListener("spfrequest",t),document.addEventListener("yt-navigate-start",t),window.location.hostname.includes("m.youtube.com")){let e=await(0,i.Nc)("#player");e&&(await(0,i._v)(2300),await F(e,"youtube","yt-translate-stop"),new MutationObserver((async t=>{for(const n of t)"attributes"===n.type&&"src"===n.attributeName&&(e=await(0,i.Nc)("#player"),await(0,i._v)(2300),await F(e,"youtube","yt-translate-stop"))})).observe(e,{attributes:!0,childList:!0,subtree:!0,attributeOldValue:!0}));const t=()=>{document.body.dispatchEvent(new Event("yt-translate-stop"))};document.addEventListener("spfdone",t),document.addEventListener("yt-navigate-finish",t),document.addEventListener("spfrequest",t),document.addEventListener("yt-navigate-start",t)}}else if(window.location.hostname.includes("twitch.tv")){if(f.Z.log("[initWebsite] Found a match with twitch.tv"),window.location.hostname.includes("m.twitch.tv")&&(window.location.pathname.includes("/videos/")||window.location.pathname.includes("/clip/"))){if(f.Z.log("[initWebsite] Matched Twitch Mobile"),await(0,i.Nc)(h.Z.twitchMobileSelector)){await(0,i._v)(200);const e=document.querySelector(h.Z.twitchMobileSelector);await F(e,"twitch",null),new MutationObserver((async t=>{for(const n of t)"attributes"===n.type&&"src"===n.attributeName&&n.target===e?.querySelector("video")&&(await(0,i._v)(1e3),await F(e,"twitch",null))})).observe(e,{attributes:!0,childList:!0,subtree:!0,attributeOldValue:!0})}}else if(window.location.hostname.includes("player.twitch.tv")||window.location.hostname.includes("clips.twitch.tv")||window.location.pathname.includes("/videos/")||window.location.pathname.includes("/clip/")){f.Z.log("[initWebsite] Matched Twitch Desktop");const e=await(0,i.Nc)(h.Z.twitchSelector);e&&(await(0,i._v)(200),await F(e,"twitch",null))}f.Z.log("[initWebsite] Exit function in the twitch section")}else{if(window.location.hostname.includes("xvideos.com"))return f.Z.log("[entered] xvideos"),await(0,i._v)(1e3),void await F(document.querySelector(".video-bg-pic"),"xvideos",null);if(window.location.hostname.includes("pornhub.com"))return f.Z.log("[entered] pornhub"),await(0,i._v)(1e3),void await F(document.querySelector(".mgp_videoWrapper"),"pornhub",null);if(l.a.includes(window.location.hostname))f.Z.log("[entered] invidious"),await F(document.querySelector("#player"),"youtube",null);else if(l.U.includes(window.location.hostname)){f.Z.log("[entered] piped");const e=await(0,i.Nc)(h.Z.pipedSelector);if(e){let t,n=(0,i.gJ)("youtube");await F(e,"youtube","piped"),setInterval((async()=>{t=(0,i.gJ)("youtube"),n!==t&&(t&&await F(document.querySelector(h.Z.pipedSelector),"youtube","piped"),n=t)}),3e3)}}else if(/^(www.|m.)?vk.(com|ru)$/.test(window.location.hostname)){if(f.Z.log("[entered] vk.com"),await(0,i.Nc)(h.Z.vkSelector)){let e;await F(document.querySelector(h.Z.vkSelector),"vk",null);let t=(0,i.gJ)("vk");setInterval((async()=>{if(e=(0,i.gJ)("vk"),t!==e){if(e){const e=await(0,i.Nc)(h.Z.vkSelector);e&&await F(e,"vk",null)}t=e}}),3e3)}}else if(window.location.hostname.includes("vimeo.com"))f.Z.log("[entered] vimeo.com"),await(0,i.Nc)(h.Z.vimeoSelector)&&(await(0,i._v)(1e3),await F(document.querySelector(h.Z.vimeoSelector),"vimeo",null));else if(window.location.hostname.includes("9gag.com"))await(0,i._v)(1e3),await F(document.querySelector(h.Z.gagSelector),"9gag",null);else if(window.location.hostname.includes("coub.com"))await(0,i._v)(1e3),await F(document.querySelector(".viewer__player"),"coub",null);else if(window.location.hostname.includes("bitchute.com"))await(0,i._v)(1e3),await F(document.querySelector(".plyr__video-wrapper"),"bitchute",null);else if(window.location.hostname.includes("rutube.ru")){const e=window.location.pathname.includes("/play/embed")?"#app > div > div":".video-player > div > div > div:nth-child(2)",t=await(0,i.Nc)(e);t&&await F(t,"rutube",null)}else if(window.location.hostname.includes("bilibili.com")){if(window.location.pathname.includes("/video/")){const e=await(0,i.Nc)(h.Z.bilibilicomSelector);e&&await F(e,"bilibili.com",null)}else if(window.location.pathname.includes("/blackboard/webplayer/embed-old.html")){const e=await(0,i.Nc)("video");e&&await F(e.parentElement,"bilibili.com",null)}}else if(window.location.hostname.includes("twitter.com")){const e=await(0,i.Nc)(h.Z.twitterSelector);if(e){let t,n=(0,i.gJ)("twitter");await F(e,"twitter",null),setInterval((async()=>{t=(0,i.gJ)("twitter"),n!==t&&(t&&await F(document.querySelector(h.Z.twitterSelector),"twitter",null),n=t)}),3e3)}}else if(window.location.hostname.includes("my.mail.ru")){const e=await(0,i.Nc)(h.Z.mailSelector);if(e){let t,n=(0,i.gJ)("mail.ru");await F(e,"mail.ru",null),setInterval((async()=>{t=(0,i.gJ)("mail.ru"),n!==t&&(t&&await F(document.querySelector(h.Z.mailSelector),"mail.ru",null),n=t)}),3e3)}}else if(window.location.hostname.includes("coursera.org")){const e=await(0,i.Nc)("#video_player");if(e){let t,n=(0,i.gJ)("coursera");await F(e,"coursera",null),setInterval((async()=>{t=(0,i.gJ)("coursera"),n!==t&&(t&&await F(document.querySelector("#video_player"),"coursera",null),n=t)}),3e3)}}else if(window.location.hostname.includes("udemy.com")){const e=await(0,i.Nc)(".vjs-v7");if(e){let t,n=(0,i.gJ)("udemy");await F(e,"udemy",null),setInterval((async()=>{if(t=(0,i.gJ)("udemy"),n!==t){const e=await(0,i.Nc)(".vjs-v7");t&&e&&await F(e,"udemy",null),n=t}}),3e3)}}}}()}try{await Promise.allSettled([u.V.update(),L()])}catch(M){console.error("[VOT]",M)}t()}catch(j){t(j)}}),1)},"./src/indexedDB.js":(e,t,n)=>{n.d(t,{CZ:()=>u,Lj:()=>d,l6:()=>c,zK:()=>l});var o=n("./src/menu.js"),a=n("./src/localization/localizationProvider.js");const r=4,i=[{key:"settings",autoTranslate:0,defaultVolume:100,showVideoSlider:0,syncVolume:0,autoSetVolumeYandexStyle:1,dontTranslateYourLang:1},{audioProxy:0},{subtitlesMaxLength:300,highlightWords:0,responseLanguage:o.KQ},{udemyData:{accessToken:"",expires:0}}];function s(e){return indexedDB.open(e,r)}async function l(){return new Promise(((e,t)=>{const n=s("VOT");n.onerror=()=>{console.error(`[VOT] ${a.V.getDefault("VOTFailedInitDB")}: ${n.error.message}`),t(!1)},n.onupgradeneeded=o=>{const r=n.result;if(r.onerror=()=>{console.error(`[VOT] ${a.V.getDefault("VOTFailedInitDB")}`,n.error),alert(`[VOT] ${a.V.get("VOTFailedInitDB")}`),t(!1)},o.oldVersion<1){const n=Object.assign({},...i.filter(((e,t)=>t>o.oldVersion-1&&t<=o.newVersion-1))),a=r.createObjectStore("settings",{keyPath:"key"});for(const e of Object.keys(n).filter((e=>"key"!==e)))a.createIndex(e,e,{unique:!1});return console.log("[VOT] Database Created"),void(a.transaction.oncomplete=()=>{const o=r.transaction("settings","readwrite").objectStore("settings").add(n);o.onsuccess=()=>{console.log("[VOT] Standard settings added to the Database: ",o.result),e(!0)},o.onerror=()=>{console.log("[VOT] Error when adding standard settings to the Database: ",o.error),t(!1)}})}!function(n,o,a,r={}){const s=n.objectStore("settings");for(const e of Object.keys(a))s.createIndex(e,e,{unique:!1});console.log("[VOT] The database has been updated"),s.transaction.oncomplete=()=>{const n=o.transaction("settings","readwrite").objectStore("settings"),s=n.get("settings");s.onerror=e=>{console.error("[VOT] Data could not be retrieved from the Database: ",e.error),t(!1)},s.onsuccess=()=>{const o=s.result||Object.assign(i[0],r);for(const e in a)o[e]=a[e];const l=n.put(o);l.onerror=e=>{console.error("[VOT] Failed to update the Database to new version",e.error),t(!1)},l.onsuccess=()=>{console.log("[VOT] Standard settings of the new version have been added to the Database."),e(!0)}}}}(n.transaction,r,Object.assign({},...i.filter(((e,t)=>t>o.oldVersion-1&&t<=o.newVersion-1))))},n.onsuccess=()=>{const o=n.result;o.onversionchange=()=>{o.close(),console.log(`[VOT] ${a.V.getDefault("VOTDBNeedUpdate")}`),alert(`[VOT] ${a.V.get("VOTDBNeedUpdate")}`),window.location.reload(),t(!1)},e(!0)},n.onblocked=()=>{const e=n.result;console.error(`[VOT] ${a.V.getDefault("VOTDisabledForDBUpdating").format(window.location.hostname)}`,e),alert(`[VOT] ${a.V.get("VOTDisabledForDBUpdating").format(window.location.hostname)}`),t(!1)}}))}async function c({autoTranslate:e,defaultVolume:t,showVideoSlider:n,syncVolume:o,autoSetVolumeYandexStyle:r,dontTranslateYourLang:i,audioProxy:c,subtitlesMaxLength:u,highlightWords:d,responseLanguage:g,udemyData:p}){return new Promise(((m,h)=>{if("number"==typeof e||"number"==typeof t||"number"==typeof n||"number"==typeof o||"number"==typeof r||"number"==typeof i||"number"==typeof c||"number"==typeof u||"number"==typeof d||"string"==typeof g||"object"==typeof p){const f=s("VOT");f.onerror=()=>{console.error(`[VOT] ${a.V.getDefault("VOTFailedWriteToDB")}`,f.error.message),alert(`[VOT] ${a.V.get("VOTFailedWriteToDB")}`),h(!1)},f.onupgradeneeded=async()=>{f.result.close(),await l(),m(!0)},f.onsuccess=()=>{const a=f.result;a.onversionchange=()=>{a.close(),console.log("[VOT] The database needs an update, please reload the page if it didn't happen automatically"),window.location.reload(),h(!1)};const s=a.transaction("settings","readwrite").objectStore("settings"),l=s.get("settings");l.onerror=e=>{console.error("[VOT] Data could not be retrieved from the Database: ",e.error),h(!1)},l.onsuccess=()=>{const a=l.result;"number"==typeof e&&(a.autoTranslate=e),"number"==typeof t&&(a.defaultVolume=t),"number"==typeof n&&(a.showVideoSlider=n),"number"==typeof o&&(a.syncVolume=o),"number"==typeof r&&(a.autoSetVolumeYandexStyle=r),"number"==typeof i&&(a.dontTranslateYourLang=i),"number"==typeof c&&(a.audioProxy=c),"number"==typeof u&&(a.subtitlesMaxLength=u),"number"==typeof d&&(a.highlightWords=d),"string"==typeof g&&(a.responseLanguage=g),"object"==typeof p&&(a.udemyData=p);const f=s.put(a);f.onerror=e=>{console.error("[VOT] failed update db data: ",e.error),h(!1)},f.onsuccess=()=>{m(!0)}}},f.onblocked=()=>{const e=f.result;console.error(`[VOT] ${a.V.getDefault("VOTDisabledForDBUpdating").format(window.location.hostname)}`,e),alert(`[VOT] ${a.V.get("VOTDisabledForDBUpdating").format(window.location.hostname)}`),h(!1)}}}))}async function u(){return new Promise(((e,t)=>{const n=s("VOT");n.onerror=()=>{console.error(`[VOT] ${a.V.getDefault("VOTFailedReadFromDB")}`,n.error.message),alert(`[VOT] ${a.V.get("VOTFailedReadFromDB")}`),t(!1)},n.onupgradeneeded=async()=>{n.result.close(),await l(),e(!0)},n.onsuccess=()=>{const o=n.result;o.onversionchange=()=>{o.close(),console.error(`[VOT] ${a.V.getDefault("VOTDBNeedUpdate")}`),alert(`[VOT] ${a.V.get("VOTDBNeedUpdate")}`),t(!1)};const r=o.transaction("settings").objectStore("settings").get("settings");r.onerror=e=>{console.error("[VOT]",a.V.getDefault("VOTFailedReadFromDB"),e.error),console.error("[VOT]",e),t(!1)},r.onsuccess=()=>{void 0===r.result&&(o.close(),d(),t(!1));const n=r.result;e(n)}},n.onblocked=()=>{const e=n.result;console.error(`[VOT] ${a.V.getDefault("VOTDisabledForDBUpdating").format(window.location.hostname)}`,e),alert(`[VOT] ${a.V.get("VOTDisabledForDBUpdating").format(window.location.hostname)}`),t(!1)}}))}function d(){indexedDB.deleteDatabase("VOT")}},"./src/localization/localizationProvider.js":(e,t,n)=>{n.d(t,{V:()=>r});const o=JSON.parse('{"recommended":"recommended","translateVideo":"Translate video","disableTranslate":"Turn off","translationSettings":"Translation settings","resetSettings":"Reset settings","videoBeingTranslated":"The video is being translated","videoLanguage":"Video language","translationLanguage":"Translation language","translationTake":"The translation will take","translationTakeMoreThanHour":"The translation will take more than an hour","translationTakeAboutMinute":"The translation will take about a minute","translationTakeFewMinutes":"The translation will take a few minutes","translationTakeApproximatelyMinutes":"The translation will take approximately {0} minutes","translationTakeApproximatelyMinute":"The translation will take approximately {0} minutes","unSupportedExtensionError":"Error! {0} is not supported by this version of the extension!\\n\\nPlease use the cloudflare version of the VOT extension.","requestTranslationFailed":"Failed to request video translation","audioNotReceived":"Audio link not received","grantPermissionToAutoPlay":"Grant permission to autoplay","neededAdditionalExtension":"An additional extension is needed to support this site","audioFormatNotSupported":"The audio format is not supported","VOTAutoTranslate":"Translate on open","VOTDontTranslateYourLang":"Do not translate from my language","VOTVolume":"Video volume","VOTVolumeTranslation":"Translation Volume","VOTAutoSetVolume":"Reduce video volume to ","VOTShowVideoSlider":"Video volume slider","VOTSyncVolume":"Link translation and video volume","VOTAudioProxy":"Proxy received audio","VOTDisableFromYourLang":"You have disabled the translation of the video in your language","VOTLiveNotSupported":"Translation of live streams is not supported","VOTPremiere":"Wait for the premiere to end before translating","VOTVideoIsTooLong":"Video is too long","VOTNoVideoIDFound":"No video ID found","VOTFailedInitDB":"Failed to initialize database","VOTDBNeedUpdate":"The database needs an update, please reload the page","VOTDisabledForDBUpdating":"VOT is disabled due to an error when updating the Database. Close all open tabs with {0} and try again","VOTFailedWriteToDB":"Data could not be written to the database","VOTFailedReadFromDB":"Data could not be retrieved from the database","VOTSubtitles":"Subtitles","VOTSubtitlesDisabled":"Disabled","VOTSubtitlesMaxLength":"Subtitles max length","VOTHighlightWords":"Highlight words","VOTTranslatedFrom":"translated from","VOTAutogenerated":"autogenerated","langs":{"af":"Afrikaans","ak":"Akan","sq":"Albanian","am":"Amharic","ar":"Arabic","hy":"Armenian","as":"Assamese","ay":"Aymara","az":"Azerbaijani","bn":"Bangla","eu":"Basque","be":"Belarusian","bho":"Bhojpuri","bs":"Bosnian","bg":"Bulgarian","my":"Burmese","ca":"Catalan","ceb":"Cebuano","zh":"Chinese","zh-Hans":"Chinese (Simplified)","zh-Hant":"Chinese (Traditional)","co":"Corsican","hr":"Croatian","cs":"Czech","da":"Danish","dv":"Divehi","nl":"Dutch","en":"English","eo":"Esperanto","et":"Estonian","ee":"Ewe","fil":"Filipino","fi":"Finnish","fr":"French","gl":"Galician","lg":"Ganda","ka":"Georgian","de":"German","el":"Greek","gn":"Guarani","gu":"Gujarati","ht":"Haitian Creole","ha":"Hausa","haw":"Hawaiian","iw":"Hebrew","hi":"Hindi","hmn":"Hmong","hu":"Hungarian","is":"Icelandic","ig":"Igbo","id":"Indonesian","ga":"Irish","it":"Italian","ja":"Japanese","jv":"Javanese","kn":"Kannada","kk":"Kazakh","km":"Khmer","rw":"Kinyarwanda","ko":"Korean","kri":"Krio","ku":"Kurdish","ky":"Kyrgyz","lo":"Lao","la":"Latin","lv":"Latvian","ln":"Lingala","lt":"Lithuanian","lb":"Luxembourgish","mk":"Macedonian","mg":"Malagasy","ms":"Malay","ml":"Malayalam","mt":"Maltese","mi":"Māori","mr":"Marathi","mn":"Mongolian","ne":"Nepali","nso":"Northern Sotho","no":"Norwegian","ny":"Nyanja","or":"Odia","om":"Oromo","ps":"Pashto","fa":"Persian","pl":"Polish","pt":"Portuguese","pa":"Punjabi","qu":"Quechua","ro":"Romanian","ru":"Russian","sm":"Samoan","sa":"Sanskrit","gd":"Scottish Gaelic","sr":"Serbian","sn":"Shona","sd":"Sindhi","si":"Sinhala","sk":"Slovak","sl":"Slovenian","so":"Somali","st":"Southern Sotho","es":"Spanish","su":"Sundanese","sw":"Swahili","sv":"Swedish","tg":"Tajik","ta":"Tamil","tt":"Tatar","te":"Telugu","th":"Thai","ti":"Tigrinya","ts":"Tsonga","tr":"Turkish","tk":"Turkmen","uk":"Ukrainian","ur":"Urdu","ug":"Uyghur","uz":"Uzbek","vi":"Vietnamese","cy":"Welsh","fy":"Western Frisian","xh":"Xhosa","yi":"Yiddish","yo":"Yoruba","zu":"Zulu"},"udemyAccessTokenExpired":"Your entered Udemy Access Token has expired","udemyModuleArgsNotFound":"Could not get udemy module data due to the fact that ModuleArgs was not found","VOTTranslationHelpNull":"Could not get the data required for the translate","enterUdemyAccessToken":"Enter Udemy Access Token","VOTUdemyData":"Udemy Data"}');var a=n("./src/utils/debug.js");const r=new class{lang=(navigator.language||navigator.userLanguage)?.substr(0,2)?.toLowerCase()??"en";locale={};constructor(){this.setLocaleFromJsonString(window.localStorage.getItem("vot-locale"))}async update(e=!1){(e||1!==Number(window.localStorage.getItem("vot-locale-version"))||window.localStorage.getItem("vot-locale-lang")!==this.lang)&&(a.Z.log("Updating locale..."),await fetch(`https://raw.githubusercontent.com/ilyhalight/voice-over-translation/master/src/localization/locales/${this.lang}.json`).then((e=>{if(200===e.status)return e.text();throw e.status})).then((e=>{window.localStorage.setItem("vot-locale",e),this.setLocaleFromJsonString(e),window.localStorage.setItem("vot-locale-version",1),window.localStorage.setItem("vot-locale-lang",this.lang)})).catch((e=>{console.error("[VOT] [localizationProvider] failed get locale, cause:",e),this.setLocaleFromJsonString(window.localStorage.getItem("vot-locale"))})))}setLocaleFromJsonString(e){try{this.locale=JSON.parse(e)??{}}catch(e){console.error("[VOT] [localizationProvider]",e),this.locale={}}}getFromLocale(e,t){const n=t.split(".").reduce(((e,t)=>{if("object"==typeof e&&e)return e[t]}),e);return void 0===n&&console.warn("[VOT] [localizationProvider] locale",e,"doesn't contain key",t),n}getDefault(e){return this.getFromLocale(o,e)??e}get(e){return this.getFromLocale(this.locale,e)??this.getFromLocale(o,e)??e}}},"./src/menu.js":(e,t,n)=>{n.d(t,{Ef:()=>f,H0:()=>p,KQ:()=>i,Mr:()=>h,NX:()=>g,Ot:()=>d,iT:()=>m,uJ:()=>u});var o=n("./src/localization/localizationProvider.js"),a=n("./src/utils/debug.js");const r=navigator.language||navigator.userLanguage;let i=r?.substr(0,2)?.toLowerCase()??"en";function s(e){document.querySelector(".translationBtn").style.color=e}function l(e="none"){document.querySelector(".translationBtn").dataset.state=e}function c(e="none"){let t;switch(e){case"error":t="#7A7A7D";break;case"success":t="#A36EFF";break;default:t="#FFFFFF"}document.querySelector(".translateIcon").style.fill=t}function u(e="none",t){switch(e){case"error":c(e),s("#7A7A7D"),l(e);break;case"success":c(e),s("#A36EFF"),l(e);break;default:c("none"),s("#FFFFFF"),l("none")}document.querySelector(".translationBtn").innerText=t}function d(e){if(!e||e.querySelector(".translationBlock"))return;const t=document.createElement("div");t.classList.add("translationBlock"),t.innerHTML=`\n    <span class = "translationArea" role = "button">\n      <span class = "translationITranslate" tabindex = "-1">\n        <svg class="translateIcon" width="24" height="24" viewBox="0 0 32 32" fill="#fff" xmlns="http://www.w3.org/2000/svg">\n          <path fill-rule="evenodd" clip-rule="evenodd" d="M17.605 19.703c.794-.13 1.647-.476 2.47-.983.695 1.013 1.255 1.546 1.306 1.593l1.166-1.207c-.011-.01-.504-.48-1.124-1.401.277-.25.547-.512.797-.798a12.1 12.1 0 0 0 2.268-3.826c.383.216.761.541.96 1.027.68 1.649-.301 3.557-1.215 4.385l1.152 1.22c1.52-1.378 2.571-3.959 1.638-6.227-.368-.892-1.077-1.59-2.064-2.037.162-.763.216-1.38.233-1.785h-1.698c-.017.307-.06.762-.173 1.323-1.325-.187-2.818-.006-4.248.508a25.994 25.994 0 0 1-.313-2.547c5.092-.287 8.098-1.488 8.237-1.546l-.654-1.533c-.03.013-2.875 1.14-7.65 1.418-.001-.405-.008-.666-.012-.85-.008-.339-.01-.423.03-.67L17.01 5.75c-.026.283-.024.573-.018 1.278l.002.318c-.026 0-.051 0-.077.002l-.08.001a39.286 39.286 0 0 1-3.27-.14L13.25 8.89c.5.043 2.023.122 3.397.122h.1a19.457 19.457 0 0 1 .208-.003l.106-.002c.067.948.196 2.034.421 3.22a8.05 8.05 0 0 0-2.267 1.963l.811 1.871c.327-.732.995-1.51 1.856-2.111a16.762 16.762 0 0 0 1.33 3.346c-.811.514-1.64.818-2.301.804l.694 1.603Zm2.953-3.488a8.18 8.18 0 0 0 .374-.389 10.465 10.465 0 0 0 1.927-3.224c-.198-.021-.4-.031-.606-.031-.907 0-1.885.199-2.834.574.31 1.209.718 2.23 1.14 3.07ZM9.769 11.688 4.25 24.438h2.259l1.357-3.407h5.582l1.357 3.407h2.258l-5.52-12.75H9.77Zm.887 2.624 2.056 5H8.6l2.056-5Z"></path>\n        </svg>\n      </span>\n      <span class = "translationBtn" tabindex = "0">${o.V.get("translateVideo")}</span>\n    </span>\n    <span class = "translationMenu" tabindex = "0" role = "button">\n      <svg class = "translationMenuIcon" height="15" width="5" fill="#fff" xmlns="http://www.w3.org/2000/svg">\n        <path d="M3.5 1.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0ZM3.5 7.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0ZM3.5 13.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0Z"></path>\n      </svg>\n    </span>\n  `,e.appendChild(t),a.Z.log("Added translation button to ",e)}function g(){const e=document.createElement("div");return e.classList.add("translationMenuContent"),e.innerHTML=`\n    <p class = "translationMainHeader">${o.V.get("translationSettings")}</p>\n    <div class="translationMenuOptions"></div>\n    <div class="translationMenuFunctional">\n      <a class = "translationDownload">\n        <svg width="24px" height="24px" data-darkreader-inline-stroke="" fill="none" stroke="currentColor" style="--darkreader-inline-stroke: currentColor;" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>\n        </svg>\n      </a>\n      <button class = "translationDropDB">${o.V.get("resetSettings")}</button>\n    </div>\n  `,e.onclick=e=>e.stopPropagation(),e}function p(e,t,n){const o=document.createElement("div"),a=document.createElement("input"),r=document.createElement("label");return a.type="checkbox",a.id=e,a.checked=Boolean(t),r.htmlFor=e,r.innerHTML=n,o.classList.add("translationMenuContainer"),o.appendChild(a),o.appendChild(r),o}function m(e,t,n,o=0,a=100){const r=document.createElement("div"),i=document.createElement("input"),s=document.createElement("label");return i.type="range",i.id=e,i.classList.add("VOTMenuSlider"),i.min=o,i.max=a,i.value=t,s.htmlFor=e,s.classList.add("translationHeader"),s.innerHTML=n,r.classList.add("translationMenuContainer"),r.appendChild(s),r.appendChild(i),r}function h(e,t){const n=document.createElement("div"),o=document.createElement("select");o.id=e,o.classList.add("VOTMenuSelect");for(const e of t){const t=document.createElement("option");t.innerText=e.label,t.value=e.value,Object.prototype.hasOwnProperty.call(e,"selected")&&e.selected&&t.setAttribute("selected","selected"),Object.prototype.hasOwnProperty.call(e,"disabled")&&(t.disabled=e.disabled),o.appendChild(t)}return n.classList.add("translationMenuContainer"),n.appendChild(o),n}function f(e,t){console.log(e);const n=e.map((e=>({label:o.V.get("langs")[e]??e.toUpperCase(),value:e,selected:t===e})));return console.log(n),n}},"./src/rvt.js":(e,t,n)=>{n.d(t,{Z:()=>s});var o=n("./src/getUUID.js"),a=n("./src/getSignature.js"),r=n("./src/yandexProtobuf.js"),i=n("./src/utils/debug.js");const s=async function(e,t,s,l,c,u){try{i.Z.log("requestVideoTranslation");const d=(await Promise.resolve().then(n.bind(n,"./src/yandexRequest.js"))).default;i.Z.log("Inited yandexRequest...");const g=r.X.encodeTranslationRequest(e,t,s,l,c);await d("/video-translation/translate",g,{"Vtrans-Signature":await(0,a.o)(g),"Sec-Vtrans-Token":(0,o.F)(!1)},u)}catch(e){console.error("[VOT]",e),u(!1)}}},"./src/subtitles.js":(e,t,n)=>{n.d(t,{e7:()=>y,Hl:()=>m,MF:()=>h,b6:()=>M,Lg:()=>L,Bv:()=>k});var o=n("./src/utils/youtubeUtils.js"),a=n("./src/utils/utils.js"),r=n("./src/yandexProtobuf.js"),i=n("./src/config/constants.js"),s=n("./src/menu.js"),l=n("./src/getUUID.js"),c=n("./src/getSignature.js"),u=n("./src/utils/debug.js");const d=async function(e,t,o){try{u.Z.log("requestVideoSubtitles");const a=(await Promise.resolve().then(n.bind(n,"./src/yandexRequest.js"))).default;u.Z.log("Inited yandexRequest...");const i=r.X.encodeSubtitlesRequest(e,t);await a("/video-subtitles/get-subtitles",i,{"Vsubs-Signature":await(0,c.o)(i),"Sec-Vsubs-Token":(0,l.F)(!1)},o)}catch(e){console.error("[VOT]",e),o(!1)}};function g(e){const t=e.startMs+e.durationMs;return e.tokens.reduce(((n,o,a)=>{const r=e.tokens[a+1],i=n[n.length-1],s=i?.alignRange?.end??0,l=s+o.text.length;if(n.push(Object.assign(Object.assign({},o),{alignRange:{start:s,end:l}})),r){const e=o.startMs+o.durationMs,a=r.startMs?r.startMs-e:t-e;n.push({text:" ",startMs:e,durationMs:a,alignRange:{start:l,end:l+1}})}return n}),[])}function p(e,t){const n=e.text.split(new RegExp("([\n \t])")).reduce(((e,n)=>{if(n.length){const o=e[e.length-1]??t,a=o?.alignRange?.end??0,r=a+n.length;e.push({text:n,alignRange:{start:a,end:r}})}return e}),[]),o=Math.floor(e.durationMs/n.length),a=e.startMs+e.durationMs;return n.map(((t,r)=>{const i=r===n.length-1,s=e.startMs+o*r,l=i?a-s:o;return Object.assign(Object.assign({},t),{startMs:s,durationMs:l})}))}async function m(e){let t=!1,n=await Promise.race([new Promise((async e=>{await(0,a._v)(5e3),t||console.error("[VOT] Failed to fetch subtitles. Reason: timeout"),t=!0,e([])})),new Promise((async n=>{u.Z.log("Fetching subtitles:",e),await fetch(e.url).then((e=>e.json())).then((e=>{t=!0,n(e)})).catch((e=>{console.error("[VOT] Failed to fetch subtitles. Reason:",e),t=!0,n({containsTokens:!1,subtitles:[]})}))}))]);return"youtube"===e.source&&(n=function(e){const t={containsTokens:!1,subtitles:[]};if("object"!=typeof e||!("events"in e)||!Array.isArray(e.events))return console.error("[VOT] Failed to format youtube subtitles",e),t;for(let n=0;n<e.events.length;n++){if(!e.events[n].segs)continue;const o=e.events[n].segs.map((e=>e.utf8.replace(/^ +| +$/g,""))).join(" ");let a=e.events[n].dDurationMs;e.events[n+1]&&e.events[n].tStartMs+e.events[n].dDurationMs>e.events[n+1].tStartMs&&(a=e.events[n+1].tStartMs-e.events[n].tStartMs),"\n"!==o&&t.subtitles.push({text:o,startMs:e.events[n].tStartMs,durationMs:a})}return t}(n)),n.subtitles=function(e,t){const n=[];let o;for(const a of e.subtitles){let r;if(a?.tokens?.length){if("yandex"!==t)return console.warn("[VOT] Unsupported subtitles tokens type: ",t),e.containsTokens=!1,null;r=g(a)}else r=p(a,o);o=r[r.length-1],n.push(Object.assign(Object.assign({},a),{tokens:r}))}return e.containsTokens=!0,n}(n,e.source),console.log("[VOT] subtitles:",n),n}async function h(e,t,n){const l="youtube"===e?o.K.getSubtitles():[];let c=!1;const g=await Promise.race([new Promise((async e=>{await(0,a._v)(5e3),c||console.error("[VOT] Failed get yandex subtitles. Reason: timeout"),c=!0,e([])})),new Promise((o=>{d(`${i.g$[e]}${t}`,n,((e,t)=>{u.Z.log("[exec callback] Requesting video subtitles"),e||(console.error("[VOT] Failed get yandex subtitles"),c=!0,o([]));const n=r.X.decodeSubtitlesResponse(t);console.log("[VOT] Subtitles response: ",n);let a=n.subtitles??[];a=a.reduce(((e,t)=>(t.language&&!e.find((e=>{if("yandex"===e.source&&e.language===t.language&&!e.translatedFromLanguage)return e}))&&e.push({source:"yandex",language:t.language,url:t.url}),t.translatedLanguage&&e.push({source:"yandex",language:t.translatedLanguage,translatedFromLanguage:t.language,url:t.translatedUrl}),e)),[]),c=!0,o(a)}))}))]),p=[...g,...l].sort(((e,t)=>{if(e.source!==t.source)return"yandex"===e.source?-1:1;if(e.language!==t.language&&(e.language===s.KQ||t.language===s.KQ))return e.language===s.KQ?-1:1;if("yandex"===e.source){if(e.translatedFromLanguage!==t.translatedFromLanguage)return e.translatedFromLanguage&&t.translatedFromLanguage?e.translatedFromLanguage===n?-1:1:e.language===t.language?e.translatedFromLanguage?1:-1:e.translatedFromLanguage?-1:1;if(!e.translatedFromLanguage)return e.language===n?-1:1}return"youtube"===e.source&&e.isAutoGenerated!==t.isAutoGenerated?e.isAutoGenerated?1:-1:0}));return console.log("[VOT] subtitles list",p),p}var f=null;function y(e){if(e.querySelector(".VOTSubtitlesWidget"))return;const t=document.createElement("div");t.classList.add("VOTSubtitlesWidget"),e.appendChild(t),f=t;let n,o,a,r,i=!1;document.addEventListener("mousedown",(function(s){t.contains(s.target)&&(n=t.getBoundingClientRect(),o=e.getBoundingClientRect(),a=s.clientX-n.x,r=s.clientY-n.y,i=!0)})),document.addEventListener("mouseup",(function(){i=!1})),document.addEventListener("mousemove",(function(e){if(i){e.preventDefault();const i=e.clientX-a,s=e.clientY-r,l=s>=o.top,c=s+n.height<=o.bottom,u=i>=o.left,d=i+n.width<=o.right;t.style.top=l&&c?s-o.y+"px":l?o.height-n.height+"px":"0px",t.style.left=u&&d?i-o.x+"px":u?o.width-n.width+"px":"0px"}}))}var w=null,b=null,v=null,T=300,V=/.{1,300}(?:\s|$)/g,S=!1;function O(e){if(!e)return;let t="",n=S&&w?.containsTokens;const o=1e3*e.currentTime,a=w?.subtitles?.findLast((e=>e.startMs<o&&o<e.startMs+e.durationMs));if(a)if(n){let e=a.tokens;if(e.at(-1).alignRange.end>T){let t=[],n=0,a=0,r=0;for(let o=0;o<e.length+1;o++){if(r+=e[o]?.text?.length??0,!e[o]||r>T){let i=e.slice(n,a+1);i.at(0)&&" "===i.at(0).text&&(i=i.slice(1)),i.at(-1)&&" "===i.at(-1).text&&(i=i.slice(0,i.length-1)),t.push({startMs:e[n].startMs,durationMs:e[a].startMs+e[a].durationMs-e[n].startMs,tokens:i}),n=o,r=0}a=o}for(let n=0;n<t.length;n++)if(t[n].startMs<o&&o<t[n].startMs+t[n].durationMs){e=t[n].tokens;break}}for(let n of e){const e=n.startMs+n.durationMs/2;t+=`<span ${o>e||o>n.startMs-100&&e-o<275?'class="passed"':""}>${n.text}</span>`}}else if(a.text.length>T){let e=a.text.match(V),n=a.durationMs/e.length;for(let r=0;r<e.length;r++)if(a.startMs+n*r<o&&o<a.startMs+n*(r+1)){t=e[r].trim();break}}else t=a.text;t!==v&&(v=t,f.innerHTML=t?`<div>${t.replace("\\n","<br>")}</div>`:"")}function x(e){O(e.target)}function k(e,t){t&&e?(w=t,b=e,e?.addEventListener("timeupdate",x),O(e)):(w=null,e?.removeEventListener("timeupdate",x),f.innerHTML="")}function L(e){"number"==typeof e&&e&&(T=e,V=new RegExp(`.{1,${e}}(?:\\s|$)`,"g"),O(b))}function M(e){S!==!!e&&(S=!!e,O(b))}},"./src/utils/VOTLocalizedError.js":(e,t,n)=>{n.d(t,{C:()=>a});var o=n("./src/localization/localizationProvider.js");class a extends Error{constructor(e){super(o.V.getDefault(e)),this.name="VOTLocalizedError",this.unlocalizedMessage=e,this.localizedMessage=o.V.get(e)}}},"./src/utils/courseraUtils.js":(e,t,n)=>{n.d(t,{O:()=>l});var o=n("./src/utils/debug.js"),a=n("./src/config/constants.js"),r=n("./src/utils/utils.js");function i(){return s()?.player}function s(){return document.querySelector("#video_player")}const l={getPlayer:s,getPlayerData:i,getVideoData:async function(e="en"){let t=null;const n=i(),{duration:s}=n?.cache_||{},{courseId:l,tracks:c,sources:u}=n?.options_||{},d=function(e){const t=e.find((e=>"video/mp4"===e.type));return t?.src}(u),g=await async function(e){const t=await fetch(`https://www.coursera.org/api/onDemandCourses.v1/${e}`),n=await t.json();return n?.elements?.[0]}(l);let p=g?.primaryLanguageCodes?.[0];p=p?(0,r.eL)(p):"en",a.tW.includes(p)||(p="en");const m=function(e,t){const n=t.find((t=>(0,r.eL)(t.srclang)===e));return n?.src}(e,c);m&&(t=[{target:"video_file_url",targetUrl:d},{target:"subtitles_file_url",targetUrl:`https://www.coursera.org${m}`}]);const h={duration:s,detectedLanguage:p,translationHelp:t};return o.Z.log("coursera video data:",h),console.log("[VOT] Detected language: ",h.detectedLanguage),h}}},"./src/utils/debug.js":(e,t,n)=>{n.d(t,{Z:()=>o});const o={log:(...e)=>{}}},"./src/utils/udemyUtils.js":(e,t,n)=>{n.d(t,{O:()=>p});var o=n("./src/utils/debug.js"),a=n("./src/config/constants.js"),r=n("./src/utils/utils.js"),i=n("./src/localization/localizationProvider.js");const s="https://www.udemy.com/api-2.0";async function l(e){const t=await fetch(`${s}/courses/${e}/?`+new URLSearchParams({"fields[course]":"locale",use_remote_version:"true",caching_intent:"true"}));return await t.json()}async function c(e,t,n){if(!(e.expires+2592e3>(new Date).getTime()&&e.accessToken))return void console.error(i.V.get("udemyAccessTokenExpired"));const o=`Bearer ${e.accessToken}`,a=await fetch(`${s}/users/me/subscribed-courses/${t}/lectures/${n}/?`+new URLSearchParams({"fields[lecture]":"asset","fields[asset]":"length,media_sources,captions"}),{headers:{"x-udemy-authorization":o,authorization:o}});return await a.json()}function u(){return g()?.player}function d(){const e=document.querySelector(".ud-app-loader[data-module-id='course-taking']")?.dataset?.moduleArgs;return e?JSON.parse(e):(console.error(i.V.get("udemyModuleArgsNotFound")),{})}function g(){return document.querySelector(".vjs-v7")}const p={getPlayer:g,getPlayerData:u,getVideoData:async function(e,t="en"){let n=null;const i=u();o.Z.log("udemyData",e);const s=d();o.Z.log("moduleData: ",s);const g=s.courseId,p=window.location.pathname.match(/learn\/lecture\/([^/]+)/)?.[1];o.Z.log(`CourseId: ${g}, lectureId: ${p}`);const m=await l(g);o.Z.log("courseLang Data:",m);const h=await c(e,g,p);o.Z.log("lecture Data:",h);let f=m?.locale?.locale;f=f?(0,r.eL)(f):"en",a.tW.includes(f)||(f="en");const y=h?.asset?.length||i?.cache_?.duration,w=function(e){const t=e?.find((e=>"video/mp4"===e.type));return t?.src}(h?.asset?.media_sources),b=function(e,t){const n=e?.find((e=>(0,r.eL)(e.locale_id)===t));return n?.url}(h?.asset?.captions,t);o.Z.log(`videoURL: ${w}, subtitlesURL: ${b}`),b&&w&&(n=[{target:"video_file_url",targetUrl:w},{target:"subtitles_file_url",targetUrl:b}]);const v={duration:y,detectedLanguage:f,translationHelp:n};return o.Z.log("udemy video data:",v),console.log("[VOT] Detected language: ",v.detectedLanguage),v},getModuleData:d,getCourseLang:l,getLectureData:c}},"./src/utils/utils.js":(e,t,n)=>{n.d(t,{Nc:()=>a,PG:()=>s,WT:()=>c,_v:()=>r,eL:()=>l,gJ:()=>i});var o=n("./src/localization/localizationProvider.js");function a(e){return new Promise((t=>{const n=document.querySelector(e);if(n)return t(n);const o=new MutationObserver((()=>{const n=document.querySelector(e);n&&(t(n),o.disconnect())}));o.observe(document.body,{childList:!0,subtree:!0,once:!0})}))}String.prototype.format||(String.prototype.format=function(){var e=arguments;return this.replace(/{(\d+)}/g,(function(t,n){return void 0!==e[n]?e[n]:t}))});const r=e=>new Promise((t=>setTimeout(t,e))),i=e=>{const t=new URL(window.location.href);switch(e){case"youtube":return t.pathname.match(/(?:watch|embed)\/([^/]+)/)?.[1]||t.searchParams.get("v");case"vk":return t.pathname.match(/^\/video-?[0-9]{8,9}_[0-9]{9}$/)?t.pathname.match(/^\/video-?[0-9]{8,9}_[0-9]{9}$/)[0].slice(1):t.searchParams.get("z")?t.searchParams.get("z").split("/")[0]:!(!t.searchParams.get("oid")||!t.searchParams.get("id"))&&`video-${Math.abs(t.searchParams.get("oid"))}_${t.searchParams.get("id")}`;case"9gag":case"gag":return t.pathname.match(/gag\/([^/]+)/)?.[1];case"twitch":if(/^m\.twitch\.tv$/.test(window.location.hostname)){const e=document.head.querySelector('link[rel="canonical"]');return e?.href.match(/videos\/([^/]+)/)?.[0]||t.pathname.slice(1)}if(/^player\.twitch\.tv$/.test(window.location.hostname))return`videos/${t.searchParams.get("video")}`;if(/^clips\.twitch\.tv$/.test(window.location.hostname)){const e=document.querySelector(".tw-link[data-test-selector='stream-info-card-component__stream-avatar-link']");return!!e&&`${e.href.replace("https://www.twitch.tv/","")}/clip/${t.searchParams.get("clip")}`}return t.pathname.match(/([^/]+)\/(?:clip)\/([^/]+)/)?t.pathname.match(/([^/]+)\/(?:clip)\/([^/]+)/)[0]:t.pathname.match(/(?:videos)\/([^/]+)/)?.[0];case"tiktok":case"bitchute":return t.pathname.match(/video\/([^/]+)/)?.[1];case"vimeo":return t.pathname.match(/[^/]+\/[^/]+$/)?.[0]||t.pathname.match(/[^/]+$/)?.[0];case"xvideos":return t.pathname.match(/[^/]+\/[^/]+$/)?.[0];case"pornhub":return t.searchParams.get("viewkey")||t.pathname.match(/embed\/([^/]+)/)?.[1];case"twitter":return t.pathname.match(/status\/([^/]+)/)?.[1];case"udemy":case"facebook":return t.pathname;case"rutube":return t.pathname.match(/(?:video|embed)\/([^/]+)/)?.[1];case"coub":return t.pathname.match(/view\/([^/]+)/)?.[1];case"bilibili.com":{const e=t.searchParams.get("bvid");if(e)return e;{let e=t.pathname.match(/video\/([^/]+)/)?.[1];return e&&t.search&&null!==t.searchParams.get("p")&&(e+=`/?p=${t.searchParams.get("p")}`),e}}case"mail.ru":if(t.pathname.startsWith("/v/")||t.pathname.startsWith("/mail/"))return t.pathname;if(t.pathname.match(/video\/embed\/([^/]+)/)){const e=document.querySelector(".b-video-controls__mymail-link");return!!e&&e?.href.split("my.mail.ru")?.[1]}return!1;case"coursera":return t.pathname.match(/learn\/([^/]+)\/lecture\/([^/]+)/)?.[0];default:return!1}};function s(e){const t=Math.floor(e/60),n=Math.floor(e%60);return t>=60?o.V.get("translationTakeMoreThanHour"):t>=10&&t%10?o.V.get("translationTakeApproximatelyMinutes").format(t):1==t||0==t&&n>0?o.V.get("translationTakeAboutMinute"):o.V.get("translationTakeApproximatelyMinute").format(t)}function l(e){return e.toLowerCase().split(";")[0].trim().split("-")[0].split("_")[0]}async function c(e){const t=await fetch("https://rust-server-531j.onrender.com/detect",{method:"POST",body:e});return await t.text()}},"./src/utils/volume.js":(e,t,n)=>{function o(e,t,n,o){let a;return t>o?(a=n+(t-o),a=a>100?100:Math.max(a,0),e.volume=a/100):t<o&&(a=n-(o-t),a=a>100?100:Math.max(a,0),e.volume=a/100),a}n.d(t,{C:()=>o})},"./src/utils/youtubeUtils.js":(e,t,n)=>{n.d(t,{K:()=>u});var o=n("./src/utils/debug.js"),a=n("./src/config/constants.js"),r=n("./src/utils/utils.js");function i(){return/^m\.youtube\.com$/.test(window.location.hostname)}function s(){return i()?document.querySelector("#app"):document.querySelector("#movie_player")}function l(){const e=s();return i()?e?.data?.playerResponse??null:e?.getPlayerResponse?.call()??null}function c(){const e=s();return i()?e?.data?.playerResponse?.videoDetails??null:e?.getVideoData?.call()??null}const u={isMobile:i,getPlayer:s,getPlayerResponse:l,getPlayerData:c,getVideoVolume:function(){return document.querySelector(".html5-video-player")?.getVolume()/100},getSubtitles:function(){const e=l();let t=e?.captions?.playerCaptionsTracklistRenderer?.captionTracks??[];return t=t.reduce(((e,t)=>{if("languageCode"in t){const n=t?.languageCode?(0,r.eL)(t?.languageCode):void 0,o=t?.url||t?.baseUrl;n&&o&&e.push({source:"youtube",language:n,isAutoGenerated:"asr"===t?.kind,url:`${o.startsWith("http")?o:`${window.location.origin}/${o}`}&fmt=json3`})}return e}),[]),o.Z.log("youtube subtitles:",t),t},getVideoData:async function(){const e=s(),t=l(),n=c(),{author:i,title:u}=n??{},{shortDescription:d,isLive:g,isLiveContent:p,isUpcoming:m}=t?.videoDetails??{},h=!(!g&&!m||p);let f=await async function(e,t,n,o,a){if(!window.location.hostname.includes("m.youtube.com")){const t=e.getAudioTrack(),n=t?.getLanguageInfo();if("und"!==n?.id)return(0,r.eL)(n.id.split(".")[0])}const i=t?.captions?.playerCaptionsTracklistRenderer?.captionTracks;if(i?.length){const e=i.find((e=>"asr"===e.kind));if(e&&e.languageCode)return(0,r.eL)(e.languageCode)}const s=[o,n,a].join(" ").split("\n").filter((e=>!e.match(/https?:\/\/\S+/))).join("\n").replace(/#\S+/g,"").replace(/[^\p{L}\s]/gu,"").replace(/\s+/g," ").trim().slice(0,250);return await(0,r.WT)(s)}(e,t,u,d,i);a.tW.includes(f)||(f="en");const y={isLive:!!g,isPremiere:h,title:u,description:d,author:i,detectedLanguage:f};return o.Z.log("youtube video data:",y),console.log("[VOT] Detected language: ",y.detectedLanguage),y},setVideoVolume:function(e){return document.querySelector(".html5-video-player")?.setVolume(Math.round(100*e))}}},"./src/yandexProtobuf.js":(e,t,n)=>{n.d(t,{X:()=>m});const o=new protobuf.Type("VideoTranslationHelpObject").add(new protobuf.Field("target",1,"string")).add(new protobuf.Field("targetUrl",2,"string")),a=new protobuf.Type("VideoTranslationRequest").add(new protobuf.Field("url",3,"string")).add(new protobuf.Field("deviceId",4,"string")).add(new protobuf.Field("firstRequest",5,"bool")).add(new protobuf.Field("duration",6,"double")).add(new protobuf.Field("unknown2",7,"int32")).add(new protobuf.Field("language",8,"string")).add(new protobuf.Field("unknown3",9,"int32")).add(new protobuf.Field("unknown4",10,"int32")).add(new protobuf.Field("translationHelp",11,"VideoTranslationHelpObject","repeated")).add(new protobuf.Field("responseLanguage",14,"string")),r=new protobuf.Type("VideoSubtitlesRequest").add(new protobuf.Field("url",1,"string")).add(new protobuf.Field("language",2,"string")),i=new protobuf.Type("VideoStreamRequest").add(new protobuf.Field("url",1,"string")).add(new protobuf.Field("language",2,"string")).add(new protobuf.Field("responseLanguage",3,"string")),s=new protobuf.Type("VideoStreamPingRequest").add(new protobuf.Field("pingId",1,"int32")),l=new protobuf.Type("VideoTranslationResponse").add(new protobuf.Field("url",1,"string")).add(new protobuf.Field("duration",2,"double")).add(new protobuf.Field("status",4,"int32")).add(new protobuf.Field("remainingTime",5,"int32")).add(new protobuf.Field("unknown0",6,"int32")).add(new protobuf.Field("unknown1",7,"string")).add(new protobuf.Field("language",8,"string")).add(new protobuf.Field("message",9,"string")),c=new protobuf.Type("VideoSubtitlesObject").add(new protobuf.Field("language",1,"string")).add(new protobuf.Field("url",2,"string")).add(new protobuf.Field("unknown2",3,"int32")).add(new protobuf.Field("translatedLanguage",4,"string")).add(new protobuf.Field("translatedUrl",5,"string")).add(new protobuf.Field("unknown5",6,"int32")).add(new protobuf.Field("unknown6",7,"int32")),u=new protobuf.Type("VideoSubtitlesResponse").add(new protobuf.Field("unknown0",1,"int32")).add(new protobuf.Field("subtitles",2,"VideoSubtitlesObject","repeated")),d=new protobuf.Type("VideoStreamObject").add(new protobuf.Field("url",1,"string")).add(new protobuf.Field("timestamp",2,"int32")),g=new protobuf.Type("VideoStreamResponse").add(new protobuf.Field("interval",1,"int32")).add(new protobuf.Field("translatedInfo",2,"VideoStreamObject")).add(new protobuf.Field("pingId",3,"int32")),p=(new protobuf.Root).define("yandex").add(o).add(a).add(l).add(r).add(c).add(u).add(s).add(i).add(d).add(g),m={encodeTranslationRequest:(e,t,n,o,a)=>p.VideoTranslationRequest.encode({url:e,firstRequest:!0,duration:t,unknown2:1,language:n,unknown3:0,unknown4:0,translationHelp:a,responseLanguage:o}).finish(),decodeTranslationResponse:e=>p.VideoTranslationResponse.decode(new Uint8Array(e)),encodeSubtitlesRequest:(e,t)=>p.VideoSubtitlesRequest.encode({url:e,language:t}).finish(),decodeSubtitlesResponse:e=>p.VideoSubtitlesResponse.decode(new Uint8Array(e)),encodeStreamPingRequest:e=>p.VideoStreamPingRequest.encode({pingId:e}).finish(),encodeStreamRequest:(e,t,n)=>p.VideoStreamRequest.encode({url:e,language:t,responseLanguage:n}).finish(),decodeStreamResponse:e=>p.VideoStreamResponse.decode(new Uint8Array(e))}},"./src/yandexRequest.js":(e,t,n)=>{n.r(t),n.d(t,{default:()=>r});var o=n("./src/config/config.js"),a=n("./src/utils/debug.js");const r=async function(e,t,n,r){try{a.Z.log("yandexRequest:",e);const i={url:`https://${o.iF}${e}`,method:"POST",headers:{Accept:"application/x-protobuf","Accept-Language":"en","Content-Type":"application/x-protobuf","User-Agent":o.Rr,Pragma:"no-cache","Cache-Control":"no-cache","Sec-Fetch-Mode":"no-cors","sec-ch-ua":null,"sec-ch-ua-mobile":null,"sec-ch-ua-platform":null,...n},binary:!0,data:new Blob([t]),responseType:"arraybuffer"};GM_xmlhttpRequest({...i,onload:e=>{a.Z.log("yandexRequest:",e.status,e),r(200===e.status,e.response)},onerror:e=>{console.error("[VOT]",e),r(!1)}})}catch(e){console.error("[VOT]",e),r(!1)}}}},r={};function i(e){var t=r[e];if(void 0!==t)return t.exports;var n=r[e]={id:e,exports:{}};return a[e](n,n.exports,i),n.exports}e="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",t="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",n="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",o=e=>{e&&e.d<1&&(e.d=1,e.forEach((e=>e.r--)),e.forEach((e=>e.r--?e.r++:e())))},i.a=(a,r,i)=>{var s;i&&((s=[]).d=-1);var l,c,u,d=new Set,g=a.exports,p=new Promise(((e,t)=>{u=t,c=e}));p[t]=g,p[e]=e=>(s&&e(s),d.forEach(e),p.catch((e=>{}))),a.exports=p,r((a=>{var r;l=(a=>a.map((a=>{if(null!==a&&"object"==typeof a){if(a[e])return a;if(a.then){var r=[];r.d=0,a.then((e=>{i[t]=e,o(r)}),(e=>{i[n]=e,o(r)}));var i={};return i[e]=e=>e(r),i}}var s={};return s[e]=e=>{},s[t]=a,s})))(a);var i=()=>l.map((e=>{if(e[n])throw e[n];return e[t]})),c=new Promise((t=>{(r=()=>t(i)).r=0;var n=e=>e!==s&&!d.has(e)&&(d.add(e),e&&!e.d&&(r.r++,e.push(r)));l.map((t=>t[e](n)))}));return r.r?c:i()}),(e=>(e?u(p[n]=e):c(g),o(s)))),s&&s.d<0&&(s.d=0)},i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.nc=void 0,i("./src/index.js")})();
>>>>>>> 1ceeecb9facfffb7f90db73da1fb1b4f1b4e6ac9
